<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta
      name="description"
      content="Developer Toolbox - All-in-One Utility Hub for Developers"
    />
    <meta name="theme-color" content="#000000" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="Toolzap" />
    <link rel="manifest" href="manifest.json" />
    <link rel="apple-touch-icon" href="icons/icon-152x152.png" />
    <link rel="apple-touch-startup-image" href="icons/icon-512x512.png" />

    <!-- OpenGraph Meta Tags -->
    <meta property="og:title" content="Toolzap" />
    <meta
      property="og:description"
      content="Your all-in-one developer toolbox"
    />
    <meta property="og:image" content="toolzap.png" />
    <meta property="og:type" content="website" />

    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Toolzap" />
    <meta
      name="twitter:description"
      content="Your all-in-one developer toolbox"
    />
    <meta name="twitter:image" content="toolzap.png" />

    <title>Toolzap</title>
    <link rel="icon" href="toolzap.png" />
    <style>
      @font-face {
        font-family: "CustomFont";
        src: url("bold.ttf") format("truetype");
      }

      * {
        font-family: "CustomFont", -apple-system, BlinkMacSystemFont,
          "SF Pro Display", "SF Pro Text", "Helvetica Neue", system-ui,
          sans-serif;
      }

      /* Image enhancement styles */
      .image-slider {
        width: 100%;
        height: 4px;
        border-radius: 2px;
        background: rgba(255, 255, 255, 0.1);
        -webkit-appearance: none;
        appearance: none;
        outline: none;
        transition: all 0.2s ease;
      }

      .image-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 16px;
        height: 16px;
        border-radius: 50%;
        background: #fff;
        cursor: pointer;
        border: none;
        transition: transform 0.1s ease;
      }

      .image-slider::-moz-range-thumb {
        width: 16px;
        height: 16px;
        border-radius: 50%;
        background: #fff;
        cursor: pointer;
        border: none;
        transition: transform 0.1s ease;
      }

      .image-slider::-webkit-slider-thumb:hover,
      .image-slider::-moz-range-thumb:hover {
        transform: scale(1.2);
      }

      .image-preview {
        image-rendering: -webkit-optimize-contrast;
        image-rendering: crisp-edges;
        background: rgba(0, 0, 0, 0.2);
        transition: all 0.3s ease;
      }

      .enhance-control {
        background: rgba(0, 0, 0, 0.2);
        padding: 12px;
        border-radius: 8px;
        transition: all 0.3s ease;
      }

      .enhance-control:hover {
        background: rgba(0, 0, 0, 0.3);
      }

      .value-display {
        font-family: monospace;
        padding: 2px 6px;
        border-radius: 4px;
        background: rgba(255, 255, 255, 0.1);
      }

      #enhance-canvas {
        transition: filter 0.2s ease;
      }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/docx@8.2.3/build/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mammoth@1.6.0/mammoth.browser.min.js"></script>
    <script src="download-manager.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html {
        scroll-behavior: smooth;
        -webkit-text-size-adjust: 100%;
        -ms-text-size-adjust: 100%;
      }

      /* Prevent horizontal scroll on mobile */
      html,
      body {
        overflow-x: hidden;
        max-width: 100%;
      }

      :root {
        --primary: #000000;
        --secondary: #1c1c1e;
        --accent: #ff453a;
        --success: #30d158;
        --error: #ff453a;
        --warning: #ff9f0a;

        /* Dark theme colors */
        --bg-primary: #000000;
        --bg-secondary: #1c1c1e;
        --bg-tertiary: #2c2c2e;
        --bg-quaternary: #3a3a3c;

        --text-primary: #ffffff;
        --text-secondary: #ebebf5;
        --text-tertiary: #ebebf599;
        --text-quaternary: #ebebf54d;

        --fill-primary: #787880;
        --fill-secondary: #78788033;
        --fill-tertiary: #7878801f;
        --fill-quaternary: #78788014;

        --separator: #38383a;
        --separator-opaque: #38383a;

        --mobile-padding: 16px;
        --desktop-padding: 20px;
        --border-radius: 12px;
        --border-radius-large: 16px;
        --shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        --shadow-elevated: 0 8px 32px rgba(0, 0, 0, 0.6);
        --blur-amount: 20px;
      }

      body {
        font-family: "CustomFont", -apple-system, BlinkMacSystemFont,
          "SF Pro Display", "SF Pro Text", "Helvetica Neue", system-ui,
          sans-serif;
        background: #000000;
        min-height: 100vh;
        color: var(--text-primary);
        margin: 0;
        padding: 0;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        touch-action: manipulation;
        -webkit-text-size-adjust: 100%;
        font-feature-settings: "kern" 1, "liga" 1, "calt" 1;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 var(--mobile-padding);
        padding-top: env(safe-area-inset-top, 12px);
        width: 100%;
        box-sizing: border-box;
      }

      @media (min-width: 768px) {
        .container {
          padding: var(--desktop-padding);
        }
      }

      header {
        background: transparent;
        padding: 16px var(--mobile-padding) 8px var(--mobile-padding);
        margin-top: 12px;
        border-radius: 0;
        margin-bottom: 8px;
        animation: slideDown 0.5s ease-out;
        text-align: left;
        min-height: 44px;
        display: flex;
        align-items: center;
        justify-content: flex-start;
        gap: 12px;
      }

      .header-logo {
        height: 2.5em;
        width: 2.5em;
        margin-right: 8px;
        object-fit: contain;
      }

      @media (min-width: 768px) {
        header {
          padding: 12px 24px;
          margin-bottom: 20px;
          border-radius: var(--border-radius-large);
          background: rgba(28, 28, 30, 0.95);
          backdrop-filter: blur(var(--blur-amount));
          -webkit-backdrop-filter: blur(var(--blur-amount));
          box-shadow: var(--shadow-elevated);
          border: 1px solid var(--separator);
          text-align: left;
        }
      }

      @keyframes slideDown {
        from {
          opacity: 0;
          transform: translateY(-30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      h1 {
        font-size: 1.5rem;
        color: var(--text-primary);
        margin: 0;
        font-weight: 700;
        line-height: 1.2;
        letter-spacing: -0.02em;
        font-family: "CustomFont", -apple-system, BlinkMacSystemFont,
          "SF Pro Display", system-ui, sans-serif;
      }

      @media (min-width: 768px) {
        h1 {
          font-size: clamp(1.8rem, 5vw, 2.5rem);
          margin-bottom: 8px;
          font-weight: 700;
        }
      }

      .subtitle {
        display: none;
      }

      @media (min-width: 768px) {
        .subtitle {
          display: block;
          color: var(--text-secondary);
          font-size: clamp(0.9rem, 3vw, 1.1rem);
          margin: 0;
          line-height: 1.4;
          font-weight: 400;
          opacity: 0.8;
        }
      }

      .main-content {
        display: flex;
        flex-direction: column;
        gap: 12px;
        animation: fadeIn 0.6s ease-out;
      }

      @media (min-width: 1024px) {
        .main-content {
          display: grid;
          grid-template-columns: 280px 1fr;
          gap: 30px;
        }
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      .sidebar {
        background: rgba(28, 28, 30, 0.95);
        backdrop-filter: blur(var(--blur-amount));
        -webkit-backdrop-filter: blur(var(--blur-amount));
        padding: 20px;
        border-radius: var(--border-radius-large);
        box-shadow: var(--shadow-elevated);
        order: 2;
        border: 1px solid var(--separator);
      }

      @media (min-width: 1024px) {
        .sidebar {
          height: fit-content;
          position: sticky;
          top: 20px;
          padding: 25px;
          order: 1;
          background: rgba(28, 28, 30, 0.95);
        }
      }

      .hero {
        min-height: 30vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 2rem 2rem 1rem;
        text-align: center;
      }

      .hero h1 {
        font-size: clamp(3rem, 8vw, 5rem);
        font-weight: 800;
        line-height: 1.1;
        margin-bottom: 1.5rem;
        color: var(--text-dark);
        letter-spacing: -0.02em;
      }

      .highlight {
        background: linear-gradient(
          135deg,
          rgb(28, 28, 30) 0%,
          rgb(28, 28, 30) 100%
        );
        padding: 0.1rem 1rem;
        border-radius: 12px;
        display: inline-block;
      }

      .subtitle-hero {
        font-size: clamp(1rem, 3vw, 1.3rem);
        color: var(--text-dark);
        opacity: 0.7;
        margin-bottom: 2rem;
        max-width: 600px;
      }

      /* Mobile-first navigation tabs */
      .mobile-nav {
        display: flex;
        overflow-x: auto;
        gap: 8px;
        padding: 16px;
        background: rgba(28, 28, 30, 0.95);
        backdrop-filter: blur(var(--blur-amount));
        -webkit-backdrop-filter: blur(var(--blur-amount));
        border-radius: var(--border-radius-large);
        margin-bottom: 20px;
        box-shadow: var(--shadow-elevated);
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
        -ms-overflow-style: none;
        border: 1px solid var(--separator);
      }

      .mobile-nav::-webkit-scrollbar {
        display: none;
      }

      @media (min-width: 1024px) {
        .mobile-nav {
          display: none;
        }
      }

      .mobile-nav-item {
        min-width: 120px;
        padding: 12px 16px;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        font-weight: 600;
        text-align: center;
        font-size: 0.9rem;
        white-space: nowrap;
        background: var(--fill-tertiary);
        color: var(--text-secondary);
        border: none;
      }

      .mobile-nav-item:hover,
      .mobile-nav-item.active {
        background: #000000;
        color: white;
        transform: scale(1.02);
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
      }

      .menu-item {
        padding: 16px 20px;
        margin: 8px 0;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 0.95rem;
        color: white;
        background: rgba(28, 28, 30, 0.95);
        border: none;
        touch-action: manipulation;
      }

      .menu-item:hover {
        background: var(--fill-secondary);
        color: var(--primary);
        transform: scale(1.02);
      }

      .menu-item.active {
        background: #000000;
        color: white;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
      }

      @media (max-width: 1023px) {
        .sidebar {
          display: none;
        }
      }

      .content-area {
        background: rgba(28, 28, 30, 0.95);
        backdrop-filter: blur(var(--blur-amount));
        -webkit-backdrop-filter: blur(var(--blur-amount));
        padding: var(--mobile-padding);
        border-radius: var(--border-radius-large);
        box-shadow: var(--shadow-elevated);
        min-height: 500px;
        order: 1;
        border: 1px solid var(--separator);
      }

      @media (min-width: 768px) {
        .content-area {
          padding: 32px;
          min-height: 600px;
        }
      }

      @media (min-width: 1024px) {
        .content-area {
          padding: 35px;
          order: 2;
        }
      }

      .tool-section {
        display: none;
        animation: fadeInUp 0.4s ease-out;
        background: rgba(28, 28, 30, 0.95);
        border-radius: var(--border-radius-large);
        padding: 20px;
        margin-bottom: 20px;
      }

      .tool-section.active {
        display: block;
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .tabs {
        display: flex;
        gap: 8px;
        margin-bottom: 20px;
        flex-wrap: wrap;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
        -ms-overflow-style: none;
        padding-bottom: 4px;
      }

      .tabs::-webkit-scrollbar {
        display: none;
      }

      @media (min-width: 768px) {
        .tabs {
          gap: 10px;
          margin-bottom: 25px;
        }
      }

      .tab {
        min-width: 100px;
        padding: 12px 20px;
        border-radius: 10px;
        cursor: pointer;
        background: rgba(28, 28, 30, 0.95);
        border: none;
        transition: all 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        font-weight: 600;
        font-size: 0.9rem;
        white-space: nowrap;
        color: white;
        touch-action: manipulation;
        flex-shrink: 0;
      }

      @media (min-width: 768px) {
        .tab {
          padding: 12px 24px;
          font-size: 1rem;
          min-width: auto;
        }
      }

      .tab:hover {
        background: var(--fill-secondary);
        color: white;
        transform: scale(1.02);
      }

      .tab.active {
        background: #000000;
        color: white;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
      }

      .tab-content {
        display: none;
        animation: fadeIn 0.3s ease-out;
      }

      .tab-content.active {
        display: block;
      }

      input[type="text"],
      input[type="number"],
      input[type="date"],
      input[type="color"],
      textarea,
      select {
        width: 100%;
        padding: 14px 16px;
        border: 1px solid var(--separator);
        border-radius: 12px;
        font-size: 16px; /* Prevents zoom on iOS */
        margin: 8px 0;
        transition: all 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui,
          sans-serif;
        background: var(--bg-tertiary);
        color: var(--text-primary);
        box-sizing: border-box;
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
      }

      /* Custom file input styling */
      input[type="file"] {
        width: 100%;
        padding: 14px 16px;
        border: 1px solid var(--separator);
        border-radius: 12px;
        font-size: 16px;
        margin: 8px 0;
        transition: all 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui,
          sans-serif;
        background: #000000;
        color: white;
        box-sizing: border-box;
        cursor: pointer;
      }

      input[type="file"]::-webkit-file-upload-button {
        -webkit-appearance: none;
        background: #000000;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 8px;
        margin-right: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      input[type="file"]::file-selector-button {
        background: #000000;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 8px;
        margin-right: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      input[type="file"]:hover::-webkit-file-upload-button,
      input[type="file"]:hover::file-selector-button {
        background: #333333;
      }

      @media (min-width: 768px) {
        input[type="text"],
        input[type="number"],
        input[type="file"],
        input[type="date"],
        input[type="color"],
        textarea,
        select {
          font-size: 14px;
          padding: 12px 16px;
        }
      }

      input:focus,
      textarea:focus,
      select:focus {
        outline: none;
        border-color: #000000;
        box-shadow: 0 0 0 3px rgba(0, 0, 0, 0.2);
        background: rgba(28, 28, 30, 0.95);
      }

      input::placeholder,
      textarea::placeholder {
        color: var(--text-tertiary);
      }

      textarea {
        min-height: 120px;
        resize: vertical;
        line-height: 1.5;
      }

      @media (min-width: 768px) {
        textarea {
          min-height: 150px;
        }
      }

      button {
        padding: 14px 24px;
        border: none;
        border-radius: 12px;
        background: #000000;
        color: white;
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        margin: 8px 4px 8px 0;
        min-height: 48px; /* Touch-friendly */
        touch-action: manipulation;
        box-sizing: border-box;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        text-decoration: none;
        line-height: 1;
        letter-spacing: -0.01em;
        font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", system-ui,
          sans-serif;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      }

      @media (min-width: 768px) {
        button {
          padding: 12px 28px;
          min-height: auto;
        }
      }

      button:hover {
        background: #333333;
        transform: scale(1.02);
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
      }

      button:active {
        transform: scale(0.98);
        background: #1a1a1a;
      }

      button:disabled {
        opacity: 0.4;
        cursor: not-allowed;
        transform: none;
      }

      .btn-secondary {
        background: var(--fill-primary);
        box-shadow: 0 2px 8px rgba(120, 120, 128, 0.2);
      }

      .btn-secondary:hover {
        background: #6d6d70;
        box-shadow: 0 4px 16px rgba(120, 120, 128, 0.3);
      }

      .btn-success {
        background: var(--success);
        box-shadow: 0 2px 8px rgba(48, 209, 88, 0.2);
      }

      .btn-success:hover {
        background: #248a3d;
        box-shadow: 0 4px 16px rgba(48, 209, 88, 0.3);
      }

      .btn-error {
        background: var(--error);
        box-shadow: 0 2px 8px rgba(255, 69, 58, 0.2);
      }

      .btn-error:hover {
        background: #d70015;
        box-shadow: 0 4px 16px rgba(255, 69, 58, 0.3);
      }

      .btn-error:hover {
        background: #d70015;
      }

      .output-box {
        background: var(--bg-tertiary);
        padding: 16px;
        border-radius: 12px;
        margin: 15px 0;
        border-left: 4px solid var(--primary);
        font-family: "SF Mono", "Monaco", "Menlo", "Consolas", "Courier New",
          monospace;
        word-break: break-word;
        overflow-wrap: break-word;
        font-size: 0.9rem;
        line-height: 1.5;
        max-width: 100%;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        border: 1px solid var(--separator);
        color: var(--text-primary);
      }

      @media (min-width: 768px) {
        .output-box {
          padding: 20px;
          font-size: 1rem;
        }
      }

      .grid-2 {
        display: grid;
        grid-template-columns: 1fr;
        gap: 16px;
        margin: 16px 0;
      }

      @media (min-width: 768px) {
        .grid-2 {
          grid-template-columns: 1fr 1fr;
          gap: 20px;
          margin: 20px 0;
        }
      }

      .card {
        background: rgba(28, 28, 30, 0.95);
        padding: 20px;
        border-radius: var(--border-radius-large);
        box-shadow: var(--shadow-elevated);
        transition: all 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        border: 1px solid var(--separator);
      }

      @media (min-width: 768px) {
        .card:hover {
          transform: scale(1.01);
          box-shadow: 0 12px 40px rgba(0, 0, 0, 0.7);
        }
      }

      .btn-group {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin: 15px 0;
      }

      @media (min-width: 768px) {
        .btn-group {
          gap: 10px;
        }
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 12px;
        margin: 20px 0;
      }

      @media (min-width: 768px) {
        .stats-grid {
          grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
          gap: 15px;
        }
      }

      .alert {
        padding: 14px 16px;
        border-radius: 8px;
        margin: 15px 0;
        animation: slideIn 0.3s ease-out;
        font-size: 0.9rem;
        line-height: 1.4;
      }

      @media (min-width: 768px) {
        .alert {
          padding: 15px 20px;
          font-size: 1rem;
        }
      }

      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateX(-20px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      .alert-success {
        background: rgba(48, 209, 88, 0.15);
        border-left: 4px solid var(--success);
        color: var(--success);
        border: 1px solid var(--separator);
      }

      .alert-error {
        background: rgba(255, 69, 58, 0.15);
        border-left: 4px solid var(--error);
        color: var(--error);
        border: 1px solid var(--separator);
      }

      .alert-info {
        background: rgba(10, 132, 255, 0.15);
        border-left: 4px solid var(--primary);
        color: var(--primary);
        border: 1px solid var(--separator);
      }

      img.preview {
        max-width: 100%;
        height: auto;
        border-radius: 8px;
        margin: 15px 0;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        display: block;
      }

      .metric {
        text-align: center;
        padding: 16px;
        background: #000000;
        color: white;
        border-radius: var(--border-radius-large);
        margin: 10px 0;
        border: 1px solid var(--separator);
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
      }

      @media (min-width: 768px) {
        .metric {
          padding: 20px;
        }
      }

      .metric-value {
        font-size: clamp(1.5rem, 4vw, 2rem);
        font-weight: 700;
        display: block;
        line-height: 1.2;
        font-family: "CustomFont", -apple-system, BlinkMacSystemFont,
          "SF Pro Display", system-ui, sans-serif;
      }

      .metric-label {
        font-size: 0.85rem;
        opacity: 0.9;
        margin-top: 4px;
        display: block;
        font-weight: 500;
      }

      @media (min-width: 768px) {
        .metric-label {
          font-size: 0.9rem;
        }
      }

      #qr-output {
        text-align: center;
        margin: 20px 0;
      }

      .loader {
        border: 4px solid #f3f3f3;
        border-top: 4px solid var(--primary);
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 20px auto;
        display: none;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      input[type="color"] {
        height: 50px;
        border: 1px solid var(--separator);
        cursor: pointer;
        border-radius: 12px;
        padding: 4px;
        background: var(--bg-tertiary);
      }

      .color-preview {
        width: 100%;
        height: 80px;
        border-radius: 12px;
        margin: 15px 0;
        box-shadow: var(--shadow-elevated);
        border: 1px solid var(--separator);
      }

      @media (min-width: 768px) {
        .color-preview {
          height: 100px;
        }
      }

      /* Range inputs for mobile */
      input[type="range"] {
        -webkit-appearance: none;
        appearance: none;
        width: 100%;
        height: 8px;
        background: var(--fill-tertiary);
        border-radius: 5px;
        outline: none;
        margin: 12px 0;
        border: 1px solid var(--separator);
      }

      input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 24px;
        height: 24px;
        background: var(--primary);
        border-radius: 50%;
        cursor: pointer;
        box-shadow: var(--shadow-elevated);
        border: 2px solid var(--bg-primary);
      }

      input[type="range"]::-moz-range-thumb {
        width: 24px;
        height: 24px;
        background: var(--primary);
        border-radius: 50%;
        cursor: pointer;
        border: 2px solid var(--bg-primary);
        box-shadow: var(--shadow-elevated);
      }

      footer {
        text-align: center;
        padding: 30px var(--mobile-padding);
        color: white;
        margin-top: 40px;
        font-size: 0.9rem;
      }

      @media (min-width: 768px) {
        footer {
          padding: 30px;
          font-size: 1rem;
        }
      }

      footer a {
        color: white;
        text-decoration: none;
        font-weight: bold;
        border-bottom: 2px solid white;
        transition: all 0.3s ease;
      }

      footer a:hover {
        opacity: 0.8;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 12px;
        margin: 20px 0;
      }

      @media (min-width: 768px) {
        .stats-grid {
          grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
          gap: 15px;
        }
      }

      .stat-card {
        background: #000000;
        color: white;
        padding: 16px;
        border-radius: var(--border-radius-large);
        text-align: center;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
        border: 1px solid var(--separator);
      }

      @media (min-width: 768px) {
        .stat-card {
          padding: 20px;
        }
      }

      .stat-number {
        font-size: clamp(1.5rem, 4vw, 2rem);
        font-weight: 700;
        display: block;
        margin-bottom: 5px;
        line-height: 1.2;
        font-family: "CustomFont", -apple-system, BlinkMacSystemFont,
          "SF Pro Display", system-ui, sans-serif;
      }

      .stat-label {
        font-size: 0.85rem;
        opacity: 0.9;
        font-weight: 500;
      }

      @media (min-width: 768px) {
        .stat-label {
          font-size: 0.9rem;
        }
      }

      /* PDF-specific styles */
      #pdf-canvas {
        border: 1px solid var(--ios-separator);
        border-radius: 12px;
        box-shadow: var(--shadow);
        max-width: 100%;
        height: auto;
        display: block;
        margin: 0 auto;
      }

      .pdf-navigation {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        margin: 20px 0;
        padding: 16px;
        background: var(--bg-tertiary);
        border-radius: 12px;
        flex-wrap: wrap;
        border: 1px solid var(--separator);
      }

      @media (min-width: 768px) {
        .pdf-navigation {
          gap: 15px;
          padding: 15px;
          flex-wrap: nowrap;
        }
      }

      .pdf-page-info {
        font-weight: 600;
        color: var(--text-primary);
        font-size: 0.9rem;
        margin: 0 8px;
      }

      @media (min-width: 768px) {
        .pdf-page-info {
          font-size: 1rem;
        }
      }

      .split-option,
      .merge-option {
        margin: 15px 0;
        padding: 16px;
        border: 1px solid var(--separator);
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        background: var(--bg-secondary);
      }

      @media (min-width: 768px) {
        .split-option,
        .merge-option {
          margin: 20px 0;
          padding: 20px;
        }
      }

      .split-option:hover,
      .merge-option:hover {
        border-color: var(--primary);
        background: var(--bg-tertiary);
      }

      .split-option.active,
      .merge-option.active {
        border-color: var(--primary);
        background: var(--bg-tertiary);
      }

      .split-option input[type="radio"],
      .merge-option input[type="radio"] {
        margin-right: 10px;
        width: auto;
        accent-color: var(--primary);
      }

      .download-section {
        background: rgba(48, 209, 88, 0.15);
        padding: 16px;
        border-radius: 12px;
        margin: 15px 0;
        border-left: 4px solid var(--success);
        border: 1px solid var(--separator);
      }

      @media (min-width: 768px) {
        .download-section {
          padding: 20px;
        }
      }

      .file-info {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px;
        background: var(--bg-secondary);
        border-radius: 8px;
        margin: 5px 0;
        border: 1px solid var(--separator);
        flex-wrap: wrap;
        gap: 8px;
      }

      @media (min-width: 768px) {
        .file-info {
          padding: 10px;
          flex-wrap: nowrap;
        }
      }

      .progress-bar {
        width: 100%;
        height: 8px;
        background: var(--fill-tertiary);
        border-radius: 4px;
        overflow: hidden;
        margin: 10px 0;
        border: 1px solid var(--separator);
      }

      .progress-fill {
        height: 100%;
        background: var(--primary);
        transition: width 0.3s ease;
      }
      /* Additional dark theme optimizations */
      h2,
      h3,
      h4,
      h5,
      h6 {
        color: var(--text-primary);
        font-family: "CustomFont", -apple-system, BlinkMacSystemFont,
          "SF Pro Display", system-ui, sans-serif;
        font-weight: 600;
        letter-spacing: -0.01em;
      }

      label {
        color: var(--text-secondary);
        font-weight: 500;
        font-size: 0.95rem;
      }

      #qr-output {
        text-align: center;
        margin: 20px 0;
        padding: 20px;
        background: var(--bg-secondary);
        border-radius: 12px;
        border: 1px solid var(--separator);
      }

      .loader {
        border: 4px solid var(--fill-tertiary);
        border-top: 4px solid var(--primary);
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 20px auto;
        display: none;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* PDF Canvas styling */
      #pdf-canvas {
        border: 1px solid var(--separator);
        border-radius: 12px;
        box-shadow: var(--shadow-elevated);
        max-width: 100%;
        height: auto;
        display: block;
        margin: 0 auto;
        background: var(--bg-secondary);
      }

      /* Image Tool Styles */
      .image-upload-container {
        margin-bottom: 20px;
      }

      .preview-container {
        margin: 15px 0;
        text-align: center;
        min-height: 200px;
        display: flex;
        justify-content: center;
        align-items: center;
        background: var(--bg-tertiary);
        border-radius: var(--border-radius);
        border: 2px dashed var(--separator);
        position: relative;
        transition: all 0.3s ease;
      }

      .preview-container:hover {
        border-color: var(--primary);
        background: var(--bg-quaternary);
      }

      .upload-placeholder {
        color: var(--text-tertiary);
        font-size: 1.1rem;
        pointer-events: none;
      }

      .main-preview {
        max-width: 100%;
        max-height: 400px;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow);
      }

      .compact-controls {
        background: var(--bg-tertiary);
        padding: 12px;
        border-radius: var(--border-radius);
        margin: 10px 0;
      }

      .control-group {
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .slider-group {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .slider-group label {
        min-width: 80px;
      }

      .compact-slider {
        flex: 1;
      }

      .small-input {
        width: 70px !important;
        padding: 8px !important;
        margin: 0 !important;
      }

      .compact-button {
        padding: 8px 16px;
        min-height: 36px;
      }

      .download-button {
        margin-top: 15px;
      }

      /* Crop interface styles */
      .crop-container {
        position: relative;
        width: 100%;
        margin: 20px 0;
      }

      .crop-area {
        position: relative;
        width: 100%;
        max-width: 800px;
        margin: 0 auto;
        background: var(--bg-tertiary);
        border-radius: var(--border-radius);
        overflow: hidden;
      }

      .crop-preview-image {
        display: block;
        max-width: 100%;
        height: auto;
      }

      .crop-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
      }

      .crop-frame {
        position: absolute;
        border: 2px solid #fff;
        box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.5);
        box-sizing: border-box;
        cursor: move;
      }

      .resize-handle {
        position: absolute;
        width: 24px;
        height: 24px;
        background: #fff;
        border-radius: 50%;
        border: 2px solid #fff;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
      }

      .resize-handle.top-left {
        top: -12px;
        left: -12px;
        cursor: nw-resize;
      }
      .resize-handle.top-right {
        top: -12px;
        right: -12px;
        cursor: ne-resize;
      }
      .resize-handle.bottom-left {
        bottom: -12px;
        left: -12px;
        cursor: sw-resize;
      }
      .resize-handle.bottom-right {
        bottom: -12px;
        right: -12px;
        cursor: se-resize;
      }
      .resize-handle.top {
        top: -12px;
        left: 50%;
        margin-left: -12px;
        cursor: n-resize;
      }
      .resize-handle.right {
        top: 50%;
        right: -12px;
        margin-top: -12px;
        cursor: e-resize;
      }
      .resize-handle.bottom {
        bottom: -12px;
        left: 50%;
        margin-left: -12px;
        cursor: s-resize;
      }
      .resize-handle.left {
        top: 50%;
        left: -12px;
        margin-top: -12px;
        cursor: w-resize;
      }

      .crop-grid {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
      }

      .grid-line {
        position: absolute;
        background: rgba(255, 255, 255, 0.5);
      }

      .grid-line.horizontal {
        width: 100%;
        height: 1px;
      }

      .grid-line.vertical {
        width: 1px;
        height: 100%;
      }

      .grid-line.horizontal:nth-child(1) {
        top: 33.33%;
      }
      .grid-line.horizontal:nth-child(2) {
        top: 66.66%;
      }
      .grid-line.vertical:nth-child(3) {
        left: 33.33%;
      }
      .grid-line.vertical:nth-child(4) {
        left: 66.66%;
      }

      .crop-controls {
        display: flex;
        justify-content: center;
        gap: 12px;
        margin-top: 15px;
      }

      .icon-button {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 8px 16px;
        border-radius: 8px;
        background: var(--bg-tertiary);
        color: var(--text-primary);
        border: 1px solid var(--separator);
      }

      .primary-button {
        padding: 8px 16px;
        border-radius: 8px;
        background: var(--primary);
        color: white;
        border: none;
      }

      /* Touch-specific styles */
      @media (pointer: coarse) {
        .resize-handle {
          width: 32px;
          height: 32px;
        }
        .resize-handle.top-left {
          top: -16px;
          left: -16px;
        }
        .resize-handle.top-right {
          top: -16px;
          right: -16px;
        }
        .resize-handle.bottom-left {
          bottom: -16px;
          left: -16px;
        }
        .resize-handle.bottom-right {
          bottom: -16px;
          right: -16px;
        }
        .resize-handle.top {
          top: -16px;
          margin-left: -16px;
        }
        .resize-handle.right {
          right: -16px;
          margin-top: -16px;
        }
        .resize-handle.bottom {
          bottom: -16px;
          margin-left: -16px;
        }
        .resize-handle.left {
          left: -16px;
          margin-top: -16px;
        }
      }

      /* Live preview styles */
      .preview-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }

      .preview-content {
        max-width: 90%;
        max-height: 90vh;
      }

      /* Scrollbar styling for webkit browsers */
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }

      ::-webkit-scrollbar-track {
        background: var(--fill-tertiary);
        border-radius: 4px;
      }

      ::-webkit-scrollbar-thumb {
        background: var(--fill-primary);
        border-radius: 4px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: var(--text-tertiary);
      }

      /* ZIP Tools Styles */
      .compress-options,
      .extract-options {
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .form-group {
        margin-bottom: 15px;
      }

      .text-input {
        width: 100%;
        padding: 12px;
        border-radius: 8px;
        background: var(--bg-tertiary);
        color: var(--text-primary);
        border: 1px solid var(--separator);
        margin-top: 5px;
      }

      .encryption-options {
        background: var(--bg-quaternary);
        padding: 15px;
        border-radius: 8px;
        margin-top: 10px;
      }

      .radio-group {
        display: flex;
        gap: 20px;
        margin-bottom: 15px;
        flex-wrap: wrap;
      }

      .radio-group label {
        display: flex;
        align-items: center;
        gap: 6px;
        cursor: pointer;
      }

      .password-strength {
        margin-top: 8px;
        height: 4px;
        border-radius: 2px;
        background: var(--bg-tertiary);
        overflow: hidden;
      }

      .password-strength::before {
        content: "";
        display: block;
        height: 100%;
        width: 0;
        transition: width 0.3s ease, background-color 0.3s ease;
      }

      .password-strength.weak::before {
        width: 33.33%;
        background-color: var(--error);
      }

      .password-strength.medium::before {
        width: 66.66%;
        background-color: var(--warning);
      }

      .password-strength.strong::before {
        width: 100%;
        background-color: var(--success);
      }

      .repair-options {
        background: var(--bg-quaternary);
        padding: 15px;
        border-radius: 8px;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .checkbox-label {
        display: flex;
        align-items: center;
        gap: 8px;
        cursor: pointer;
      }

      .checkbox-label input[type="checkbox"] {
        width: auto;
        margin: 0;
      }

      .encryption-select {
        width: 100%;
        margin-bottom: 10px;
      }

      .repair-status {
        margin-top: 10px;
        padding: 10px;
        border-radius: 6px;
        font-size: 0.9em;
      }

      .repair-status.success {
        background: rgba(48, 209, 88, 0.1);
        color: var(--success);
      }

      .repair-status.warning {
        background: rgba(255, 159, 10, 0.1);
        color: var(--warning);
      }

      .repair-status.error {
        background: rgba(255, 69, 58, 0.1);
        color: var(--error);
      }

      .compression-select {
        width: 100%;
        padding: 12px;
        border-radius: 8px;
        background: var(--bg-tertiary);
        color: var(--text-primary);
        border: 1px solid var(--separator);
      }

      .file-input {
        width: 100%;
        padding: 12px;
        border-radius: 8px;
        background: var(--bg-tertiary);
        color: var(--text-primary);
        border: 1px solid var(--separator);
        cursor: pointer;
      }

      .password-input {
        width: 100%;
        margin-top: 10px;
        padding: 12px;
        border-radius: 8px;
        background: var(--bg-tertiary);
        color: var(--text-primary);
        border: 1px solid var(--separator);
      }

      .selected-files,
      .zip-contents {
        background: var(--bg-tertiary);
        border-radius: 8px;
        border: 1px solid var(--separator);
        margin: 15px 0;
      }

      .file-list-header {
        padding: 12px;
        border-bottom: 1px solid var(--separator);
        font-weight: 600;
      }

      .file-list-content {
        padding: 12px;
        max-height: 200px;
        overflow-y: auto;
      }

      .file-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px;
        border-radius: 4px;
        margin-bottom: 4px;
        background: var(--bg-quaternary);
      }

      .file-item:last-child {
        margin-bottom: 0;
      }

      .file-name {
        flex: 1;
        margin-right: 10px;
        word-break: break-all;
      }

      .file-size {
        color: var(--text-tertiary);
        font-size: 0.9em;
      }

      .remove-file {
        background: none;
        border: none;
        color: var(--error);
        cursor: pointer;
        padding: 4px 8px;
        margin: 0;
        min-height: auto;
      }

      .progress-wrapper {
        width: 100%;
        background: var(--bg-quaternary);
        border-radius: 8px;
        overflow: hidden;
        margin: 10px 0;
      }

      .progress-bar {
        height: 4px;
        background: var(--primary);
        transition: width 0.3s ease;
      }

      /* Selection styling */
      ::selection {
        background: rgba(28, 28, 30, 0.95);
        color: white;
      }

      ::-moz-selection {
        background: rgba(28, 28, 30, 0.95);
        color: white;
      }

      @media (max-width: 1023px) {
        .main-content {
          grid-template-columns: 1fr;
        }

        .sidebar {
          position: relative;
          top: 0;
        }

        .grid-2 {
          grid-template-columns: 1fr;
        }
      }

      /* Additional mobile optimizations */
      @media (max-width: 480px) {
        .container {
          padding: 12px;
        }

        .content-area {
          padding: 16px;
        }

        h1 {
          font-size: 1.8rem;
        }

        .subtitle {
          font-size: 0.9rem;
        }

        button {
          padding: 16px 20px;
          font-size: 14px;
          width: 100%;
          margin: 4px 0;
        }

        .btn-group button {
          width: auto;
          flex: 1;
        }

        .tabs {
          gap: 6px;
        }

        .tab {
          padding: 10px 16px;
          font-size: 0.85rem;
          min-width: 80px;
        }

        .mobile-nav-item {
          min-width: 100px;
          padding: 10px 14px;
          font-size: 0.8rem;
        }

        .card {
          padding: 16px;
        }

        .metric,
        .stat-card {
          padding: 14px;
        }

        .pdf-navigation {
          padding: 12px;
          gap: 8px;
        }

        .pdf-page-info {
          font-size: 0.8rem;
        }

        input,
        textarea,
        select {
          font-size: 16px; /* Prevents zoom on iOS */
        }
      }

      /* Improved touch targets */
      @media (max-width: 768px) {
        button,
        .tab,
        .menu-item,
        .mobile-nav-item {
          min-height: 44px;
          touch-action: manipulation;
        }
      }

      /* Dark mode support */
      @media (prefers-color-scheme: dark) {
        :root {
          --dark: #ffffff;
          --light: #1c1c1e;
        }

        .card,
        .content-area,
        .sidebar,
        .mobile-nav {
          background: rgba(28, 28, 30, 0.95);
          color: #ffffff;
        }

        input,
        textarea,
        select {
          background: rgba(40, 40, 60, 0.8);
          color: #f1f5f9;
          border-color: #4a5568;
        }

        .tab,
        .mobile-nav-item,
        .menu-item {
          background: rgba(40, 40, 60, 0.8);
          color: #f1f5f9;
        }
      }
    </style>
    <script>
      // Image handling functions
      function handleImageUpload(input) {
        const file = input.files[0];
        if (file) {
          const reader = new FileReader();

          reader.onload = function (e) {
            const preview = document.getElementById("main-preview");
            const placeholder = document.getElementById("upload-placeholder");

            // Create a new image to get dimensions
            const img = new Image();
            img.onload = function () {
              // Update preview
              preview.src = e.target.result;
              preview.style.display = "block";
              if (placeholder) placeholder.style.display = "none";

              // Update crop inputs with image dimensions
              document.getElementById("crop-w").value = this.width;
              document.getElementById("crop-h").value = this.height;
              document.getElementById("crop-x").value = 0;
              document.getElementById("crop-y").value = 0;

              // Update resize inputs
              document.getElementById("resize-width").value = this.width;
              document.getElementById("resize-height").value = this.height;

              // Reset enhancement sliders
              document.getElementById("brightness").value = 1;
              document.getElementById("contrast").value = 1;
              document.getElementById("brightness-val").textContent = "1";
              document.getElementById("contrast-val").textContent = "1";
            };
            img.src = e.target.result;
          };

          reader.readAsDataURL(file);
        }
      }

      // Add drag and drop support
      document.addEventListener("DOMContentLoaded", () => {
        const previewContainer = document.getElementById("preview-container");

        if (previewContainer) {
          previewContainer.addEventListener("dragover", (e) => {
            e.preventDefault();
            previewContainer.style.borderColor = "var(--primary)";
            previewContainer.style.background = "var(--bg-quaternary)";
          });

          previewContainer.addEventListener("dragleave", (e) => {
            e.preventDefault();
            previewContainer.style.borderColor = "var(--separator)";
            previewContainer.style.background = "var(--bg-tertiary)";
          });

          previewContainer.addEventListener("drop", (e) => {
            e.preventDefault();
            previewContainer.style.borderColor = "var(--separator)";
            previewContainer.style.background = "var(--bg-tertiary)";

            const file = e.dataTransfer.files[0];
            if (file && file.type.startsWith("image/")) {
              const input = document.getElementById("image-input");
              input.files = e.dataTransfer.files;
              handleImageUpload(input);
            }
          });
        }
      });

      // Live preview for enhancement
      function updateEnhance() {
        const brightnessVal = document.getElementById("brightness").value;
        const contrastVal = document.getElementById("contrast").value;

        document.getElementById("brightness-val").textContent = brightnessVal;
        document.getElementById("contrast-val").textContent = contrastVal;

        const preview = document.getElementById("main-preview");
        if (preview.style.display !== "none") {
          preview.style.filter = `brightness(${brightnessVal}) contrast(${contrastVal})`;
        }
      }

      // Crop functionality
      let cropFrame = null;
      let isDragging = false;
      let isResizing = false;
      let currentHandle = null;
      let startX = 0;
      let startY = 0;
      let originalX = 0;
      let originalY = 0;
      let originalWidth = 0;
      let originalHeight = 0;

      function initCrop() {
        const cropTab = document.querySelector('[data-tab="crop"]');
        cropTab.addEventListener("click", () => {
          setTimeout(setupCropInterface, 100);
        });
      }

      function setupCropInterface() {
        const preview = document.getElementById("main-preview");
        const cropPreviewImage = document.getElementById("crop-preview-image");

        if (preview.src) {
          cropPreviewImage.src = preview.src;
          cropPreviewImage.onload = () => {
            const cropFrame = document.querySelector(".crop-frame");
            const overlay = document.getElementById("crop-overlay");

            // Set initial crop frame size
            const width =
              Math.min(cropPreviewImage.width, cropPreviewImage.height) * 0.8;
            const x = (cropPreviewImage.width - width) / 2;
            const y = (cropPreviewImage.height - width) / 2;

            cropFrame.style.width = width + "px";
            cropFrame.style.height = width + "px";
            cropFrame.style.left = x + "px";
            cropFrame.style.top = y + "px";

            setupCropEvents();
          };
        }
      }

      function setupCropEvents() {
        const cropFrame = document.querySelector(".crop-frame");
        const handles = document.querySelectorAll(".resize-handle");

        // Dragging the crop frame
        cropFrame.addEventListener("mousedown", startDragging);
        cropFrame.addEventListener("touchstart", startDragging, {
          passive: false,
        });

        // Resizing with handles
        handles.forEach((handle) => {
          handle.addEventListener("mousedown", startResizing);
          handle.addEventListener("touchstart", startResizing, {
            passive: false,
          });
        });

        // Global mouse/touch events
        document.addEventListener("mousemove", updateCrop);
        document.addEventListener("touchmove", updateCrop, { passive: false });
        document.addEventListener("mouseup", stopCrop);
        document.addEventListener("touchend", stopCrop);
      }

      function startDragging(e) {
        if (e.target.classList.contains("resize-handle")) return;

        e.preventDefault();
        isDragging = true;
        const cropFrame = document.querySelector(".crop-frame");

        const pos = e.type === "mousedown" ? e : e.touches[0];
        startX = pos.clientX;
        startY = pos.clientY;
        originalX = cropFrame.offsetLeft;
        originalY = cropFrame.offsetTop;
      }

      function startResizing(e) {
        e.preventDefault();
        e.stopPropagation();

        isResizing = true;
        currentHandle = e.target;
        const cropFrame = document.querySelector(".crop-frame");

        const pos = e.type === "mousedown" ? e : e.touches[0];
        startX = pos.clientX;
        startY = pos.clientY;
        originalWidth = cropFrame.offsetWidth;
        originalHeight = cropFrame.offsetHeight;
        originalX = cropFrame.offsetLeft;
        originalY = cropFrame.offsetTop;
      }

      function updateCrop(e) {
        if (!isDragging && !isResizing) return;
        e.preventDefault();

        const pos = e.type === "mousemove" ? e : e.touches[0];
        const deltaX = pos.clientX - startX;
        const deltaY = pos.clientY - startY;
        const cropFrame = document.querySelector(".crop-frame");
        const cropArea = document.querySelector(".crop-area");

        if (isDragging) {
          let newX = originalX + deltaX;
          let newY = originalY + deltaY;

          // Boundary checks
          newX = Math.max(
            0,
            Math.min(newX, cropArea.offsetWidth - cropFrame.offsetWidth)
          );
          newY = Math.max(
            0,
            Math.min(newY, cropArea.offsetHeight - cropFrame.offsetHeight)
          );

          cropFrame.style.left = newX + "px";
          cropFrame.style.top = newY + "px";
        }

        if (isResizing) {
          const isLeft =
            currentHandle.classList.contains("left") ||
            currentHandle.classList.contains("top-left") ||
            currentHandle.classList.contains("bottom-left");
          const isTop =
            currentHandle.classList.contains("top") ||
            currentHandle.classList.contains("top-left") ||
            currentHandle.classList.contains("top-right");

          let newWidth = isLeft
            ? originalWidth - deltaX
            : originalWidth + (isLeft ? -deltaX : deltaX);
          let newHeight = isTop
            ? originalHeight - deltaY
            : originalHeight + (isTop ? -deltaY : deltaY);

          // Maintain minimum size
          newWidth = Math.max(50, newWidth);
          newHeight = Math.max(50, newHeight);

          // Update size
          cropFrame.style.width = newWidth + "px";
          cropFrame.style.height = newHeight + "px";

          // Update position for left/top handles
          if (isLeft) {
            cropFrame.style.left =
              originalX + (originalWidth - newWidth) + "px";
          }
          if (isTop) {
            cropFrame.style.top =
              originalY + (originalHeight - newHeight) + "px";
          }
        }
      }

      function stopCrop() {
        isDragging = false;
        isResizing = false;
        currentHandle = null;
      }

      function resetCrop() {
        setupCropInterface();
      }

      function applyCrop() {
        const cropFrame = document.querySelector(".crop-frame");
        const previewImage = document.getElementById("crop-preview-image");
        const canvas = document.getElementById("crop-canvas");
        const ctx = canvas.getContext("2d");

        // Set canvas size to crop frame size
        canvas.width = cropFrame.offsetWidth;
        canvas.height = cropFrame.offsetHeight;

        // Draw cropped portion
        ctx.drawImage(
          previewImage,
          cropFrame.offsetLeft,
          cropFrame.offsetTop,
          cropFrame.offsetWidth,
          cropFrame.offsetHeight,
          0,
          0,
          canvas.width,
          canvas.height
        );

        // Show download button
        document.getElementById("download-crop").style.display = "block";
      }

      // Initialize crop interface when the page loads
      document.addEventListener("DOMContentLoaded", initCrop);

      // ZIP Tools Functions
      document.addEventListener("DOMContentLoaded", function () {
        // Handle encryption radio buttons
        document
          .querySelectorAll('input[name="encryption"]')
          .forEach((radio) => {
            radio.addEventListener("change", function () {
              const passwordInput = document.getElementById("zip-password");
              passwordInput.disabled = this.value === "none";
            });
          });

        // Password strength meter
        document
          .getElementById("zip-password")
          .addEventListener("input", function () {
            const password = this.value;
            const strength = checkPasswordStrength(password);
            const meter = document.getElementById("password-strength");

            meter.className = "password-strength";
            if (password) {
              meter.classList.add(strength);
            }
          });

        // Handle file selection for compression
        document
          .getElementById("zip-files")
          .addEventListener("change", function (e) {
            const fileList = document.querySelector(
              "#selected-files-list .file-list-content"
            );
            fileList.innerHTML = "";

            Array.from(this.files).forEach((file) => {
              const fileItem = document.createElement("div");
              fileItem.className = "file-item";
              fileItem.innerHTML = `
              <span class="file-name">${file.name}</span>
              <span class="file-size">${formatFileSize(file.size)}</span>
            `;
              fileList.appendChild(fileItem);
            });
          });

        // Handle ZIP file selection for extraction
        document
          .getElementById("zip-extract")
          .addEventListener("change", async function (e) {
            const file = this.files[0];
            if (!file) return;

            const zipContents = document.querySelector(
              "#zip-contents .file-list-content"
            );
            zipContents.innerHTML =
              '<div class="loading">Reading ZIP contents...</div>';

            try {
              const zip = await JSZip.loadAsync(file);
              zipContents.innerHTML = "";

              Object.keys(zip.files).forEach((filename) => {
                const fileItem = document.createElement("div");
                fileItem.className = "file-item";
                fileItem.innerHTML = `
                <span class="file-name">${filename}</span>
                <span class="file-size">${formatFileSize(
                  zip.files[filename].uncompressedSize
                )}</span>
              `;
                zipContents.appendChild(fileItem);
              });
            } catch (err) {
              zipContents.innerHTML =
                '<div class="error">Error reading ZIP file</div>';
            }
          });
      });

      function formatFileSize(bytes) {
        if (bytes === 0) return "0 Bytes";
        const k = 1024;
        const sizes = ["Bytes", "KB", "MB", "GB"];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + " " + sizes[i];
      }

      function checkPasswordStrength(password) {
        if (!password) return "";

        const hasLower = /[a-z]/.test(password);
        const hasUpper = /[A-Z]/.test(password);
        const hasNumber = /\d/.test(password);
        const hasSpecial = /[!@#$%^&*(),.?":{}|<>]/.test(password);
        const length = password.length;

        const score =
          [hasLower, hasUpper, hasNumber, hasSpecial].filter(Boolean).length +
          (length >= 8 ? 1 : 0);

        if (score >= 4) return "strong";
        if (score >= 3) return "medium";
        return "weak";
      }

      async function repairZip(arrayBuffer) {
        const zip = await JSZip.loadAsync(arrayBuffer);
        const repairedFiles = new Map();
        const errors = [];

        for (const [path, file] of Object.entries(zip.files)) {
          try {
            // Try to repair file headers
            if (document.getElementById("recover-headers").checked) {
              // Attempt to reconstruct damaged headers
              const content = await file.async("uint8array");
              if (content.length > 0) {
                repairedFiles.set(path, content);
              }
            }

            // Handle CRC errors
            if (document.getElementById("ignore-crc").checked) {
              // Skip CRC validation
              const content = await file.async("uint8array", {
                checkCRC32: false,
              });
              repairedFiles.set(path, content);
            }
          } catch (err) {
            errors.push(`Failed to repair ${path}: ${err.message}`);
          }
        }

        return { repairedFiles, errors };
      }

      async function createZip() {
        const files = document.getElementById("zip-files").files;
        if (files.length === 0) {
          alert("Please select files to compress");
          return;
        }

        const compressionLevel = parseInt(
          document.getElementById("compression-level").value
        );
        const encryptionType = document.querySelector(
          'input[name="encryption"]:checked'
        ).value;
        const password = document.getElementById("zip-password").value;
        const filename =
          document.getElementById("zip-filename").value || "archive.zip";

        if (encryptionType !== "none" && !password) {
          alert("Please enter a password for encryption");
          return;
        }

        if (password && checkPasswordStrength(password) === "weak") {
          if (!confirm("The password you entered is weak. Continue anyway?")) {
            return;
          }
        }

        const zip = new JSZip();

        // Add files to zip
        for (let file of files) {
          const arrayBuffer = await file.arrayBuffer();
          zip.file(file.name, arrayBuffer, {
            compression: "DEFLATE",
            compressionOptions: {
              level: compressionLevel,
            },
          });
        }

        // Generate zip
        const options = {
          type: "blob",
          compression: "DEFLATE",
          compressionOptions: {
            level: compressionLevel,
          },
        };

        if (encrypt) {
          options.password = password;
        }

        try {
          const content = await zip.generateAsync(options, (metadata) => {
            const progress = document.querySelector(".progress-bar");
            if (progress) {
              progress.style.width = metadata.percent.toFixed(2) + "%";
            }
          });

          // Download the zip file
          saveAs(content, "archive.zip");
        } catch (err) {
          alert("Error creating ZIP: " + err.message);
        }
      }

      async function extractZip() {
        const file = document.getElementById("zip-extract").files[0];
        if (!file) {
          alert("Please select a ZIP file to extract");
          return;
        }

        const hasPassword = document.getElementById("has-password").checked;
        const password = hasPassword
          ? document.getElementById("extract-password").value
          : null;

        if (hasPassword && !password) {
          alert("Please enter the password");
          return;
        }

        try {
          const zip = await JSZip.loadAsync(file, { password });

          // Create a new zip to store extracted files
          const extractedZip = new JSZip();

          for (let [filename, file] of Object.entries(zip.files)) {
            if (!file.dir) {
              const content = await file.async("blob");
              extractedZip.file(filename, content);
            }
          }

          // Download as a new zip
          const content = await extractedZip.generateAsync({
            type: "blob",
          });

          saveAs(content, "extracted_files.zip");
        } catch (err) {
          if (err.message.includes("password")) {
            alert("Invalid password");
          } else {
            alert("Error extracting ZIP: " + err.message);
          }
        }
      }
    </script>
  </head>
  <body>
    <div class="container">
      <header>
        <img src="toolzap.png" alt="ToolZap" class="header-logo" />
        <h1>Tool Zap</h1>
      </header>

      <section class="hero">
        <h1>
          Your <span class="highlight">all-in-one</span><br />
          developer toolbox
        </h1>
      </section>

      <div class="main-content">
        <!-- Mobile Navigation -->
        <div class="mobile-nav">
          <div class="mobile-nav-item active" data-section="image-tools">
            🏞️ Images
          </div>
          <div class="mobile-nav-item" data-section="pdf-tools">📄 PDF</div>
          <div class="mobile-nav-item" data-section="code-tools">💻 Code</div>
          <div class="mobile-nav-item" data-section="dev-tools">🧑‍💻 Dev</div>
          <div class="mobile-nav-item" data-section="security-tools">
            🔐 Security
          </div>
          <div class="mobile-nav-item" data-section="zip-tools">📦 ZIP</div>
          <div class="mobile-nav-item" data-section="av-tools">🎵 A/V</div>
          <div class="mobile-nav-item" data-section="calc-tools">🧮 Calc</div>
          <div class="mobile-nav-item" data-section="prod-tools">✅ Prod</div>
          <div class="mobile-nav-item" data-section="text-tools">🔧 Text</div>
          <div class="mobile-nav-item" data-section="time-tools">⏰ Time</div>
          <div class="mobile-nav-item" data-section="about">ℹ️ About</div>
        </div>

        <div class="sidebar">
          <div class="menu-item active" data-section="image-tools">
            🏞️ Image Tools
          </div>
          <div class="menu-item" data-section="pdf-tools">📄 PDF Tools</div>
          <div class="menu-item" data-section="code-tools">💻 Code Tools</div>
          <div class="menu-item" data-section="dev-tools">🧑‍💻 Dev Tools</div>
          <div class="menu-item" data-section="security-tools">
            🔐 Security Tools
          </div>
          <div class="menu-item" data-section="zip-tools">📦 ZIP Tools</div>
          <div class="menu-item" data-section="av-tools">
            🎵 Audio/Video Tools
          </div>
          <div class="menu-item" data-section="calc-tools">
            🧮 Utility Calculators
          </div>
          <div class="menu-item" data-section="prod-tools">
            ✅ Productivity Tools
          </div>
          <div class="menu-item" data-section="text-tools">
            🔧 Text Utilities
          </div>
          <div class="menu-item" data-section="time-tools">⏰ Time & Date</div>
          <div class="menu-item" data-section="about">ℹ️ About</div>
        </div>

        <div class="content-area">
          <!-- IMAGE TOOLS -->
          <div class="tool-section active" id="image-tools">
            <h2>🖼️ Image Tools</h2>

            <div class="image-upload-container" style="margin-bottom: 20px">
              <input
                type="file"
                id="image-input"
                accept="image/*"
                onchange="handleImageUpload(this)"
                style="margin-bottom: 20px"
              />
              <div id="preview-container" class="preview-container">
                <div
                  style="
                    position: relative;
                    width: 100%;
                    padding-top: 56.25%;
                    background: rgba(255, 255, 255, 0.05);
                    border-radius: 12px;
                    overflow: hidden;
                    margin-bottom: 20px;
                  "
                >
                  <div
                    id="upload-placeholder"
                    class="upload-placeholder"
                    style="
                      position: absolute;
                      top: 0;
                      left: 0;
                      right: 0;
                      bottom: 0;
                      display: flex;
                      align-items: center;
                      justify-content: center;
                      text-align: center;
                      padding: 20px;
                      color: #888;
                    "
                  >
                    Drag & drop an image or click to upload
                  </div>
                  <canvas
                    id="enhance-canvas"
                    style="
                      display: none;
                      position: absolute;
                      top: 0;
                      left: 0;
                      width: 100%;
                      height: 100%;
                      object-fit: contain;
                    "
                  ></canvas>
                </div>
              </div>
            </div>

            <div class="tabs">
              <div class="tab active" data-tab="resize">Resize</div>
              <div class="tab" data-tab="enhance">Enhance</div>
              <div class="tab" data-tab="crop">Crop</div>
            </div>

            <div class="tab-content active" id="resize">
              <div class="compact-controls">
                <div class="control-group">
                  <div style="margin-bottom: 15px">
                    <label>Resize Mode:</label>
                    <select
                      id="resize-mode"
                      class="small-input"
                      onchange="toggleResizeMode()"
                    >
                      <option value="dimensions">By Dimensions</option>
                      <option value="filesize">By File Size</option>
                    </select>
                  </div>

                  <div id="dimensions-controls">
                    <label>Width:</label>
                    <input
                      type="number"
                      id="resize-width"
                      value="800"
                      class="small-input"
                    />
                    <label>Height:</label>
                    <input
                      type="number"
                      id="resize-height"
                      value="600"
                      class="small-input"
                    />
                  </div>

                  <div id="filesize-controls" style="display: none">
                    <label>Target File Size:</label>
                    <div style="display: flex; gap: 10px; align-items: center">
                      <input
                        type="number"
                        id="target-size"
                        value="200"
                        class="small-input"
                        style="flex: 1"
                      />
                      <select
                        id="size-unit"
                        class="small-input"
                        style="width: auto"
                      >
                        <option value="KB">KB</option>
                        <option value="MB">MB</option>
                      </select>
                    </div>
                    <div
                      class="file-info"
                      style="margin-top: 10px; font-size: 0.9em"
                    >
                      Current size: <span id="current-file-size">-</span>
                    </div>
                  </div>

                  <button
                    onclick="resizeImage()"
                    class="compact-button"
                    style="margin-top: 15px"
                  >
                    Apply
                  </button>
                </div>
              </div>
              <canvas id="resize-canvas" style="display: none"></canvas>
              <div
                style="
                  display: flex;
                  gap: 10px;
                  align-items: center;
                  margin-top: 15px;
                "
              >
                <input
                  type="text"
                  id="resize-filename"
                  placeholder="Enter filename (e.g. image.png)"
                  style="flex: 1"
                />
                <button
                  id="download-resize"
                  style="display: none"
                  onclick="downloadImage('resize-canvas', document.getElementById('resize-filename').value || 'resized.png')"
                  class="download-button"
                >
                  ⬇️ Download
                </button>
              </div>
            </div>
            <div class="tab-content" id="enhance">
              <div class="compact-controls">
                <div
                  class="control-group"
                  style="
                    background: rgba(255, 255, 255, 0.05);
                    border-radius: 12px;
                    padding: 20px;
                  "
                >
                  <div class="slider-group" style="display: grid; gap: 20px">
                    <div class="enhance-control">
                      <div
                        style="
                          display: flex;
                          justify-content: space-between;
                          margin-bottom: 8px;
                        "
                      >
                        <label style="color: #fff">Brightness</label>
                        <span class="value-display" id="brightness-value"
                          >0</span
                        >
                      </div>
                      <input
                        type="range"
                        min="-100"
                        max="100"
                        value="0"
                        class="image-slider"
                        id="brightness-slider"
                        oninput="updateEnhancement(this, 'brightness')"
                      />
                    </div>

                    <div class="enhance-control">
                      <div
                        style="
                          display: flex;
                          justify-content: space-between;
                          margin-bottom: 8px;
                        "
                      >
                        <label style="color: #fff">Contrast</label>
                        <span class="value-display" id="contrast-value">0</span>
                      </div>
                      <input
                        type="range"
                        min="-100"
                        max="100"
                        value="0"
                        class="image-slider"
                        id="contrast-slider"
                        oninput="updateEnhancement(this, 'contrast')"
                      />
                    </div>

                    <div class="enhance-control">
                      <div
                        style="
                          display: flex;
                          justify-content: space-between;
                          margin-bottom: 8px;
                        "
                      >
                        <label style="color: #fff">Saturation</label>
                        <span class="value-display" id="saturation-value"
                          >0</span
                        >
                      </div>
                      <input
                        type="range"
                        min="-100"
                        max="100"
                        value="0"
                        class="image-slider"
                        id="saturation-slider"
                        oninput="updateEnhancement(this, 'saturation')"
                      />
                    </div>

                    <div class="enhance-control">
                      <div
                        style="
                          display: flex;
                          justify-content: space-between;
                          margin-bottom: 8px;
                        "
                      >
                        <label style="color: #fff">Vibrance</label>
                        <span class="value-display" id="vibrance-value">0</span>
                      </div>
                      <input
                        type="range"
                        min="-100"
                        max="100"
                        value="0"
                        class="image-slider"
                        id="vibrance-slider"
                        oninput="updateEnhancement(this, 'vibrance')"
                      />
                    </div>

                    <div class="enhance-control">
                      <div
                        style="
                          display: flex;
                          justify-content: space-between;
                          margin-bottom: 8px;
                        "
                      >
                        <label style="color: #fff">Warmth</label>
                        <span class="value-display" id="warmth-value">0</span>
                      </div>
                      <input
                        type="range"
                        min="-100"
                        max="100"
                        value="0"
                        class="image-slider"
                        id="warmth-slider"
                        oninput="updateEnhancement(this, 'warmth')"
                      />
                    </div>

                    <div class="enhance-control">
                      <div
                        style="
                          display: flex;
                          justify-content: space-between;
                          margin-bottom: 8px;
                        "
                      >
                        <label style="color: #fff">Sharpness</label>
                        <span class="value-display" id="sharpness-value"
                          >0</span
                        >
                      </div>
                      <input
                        type="range"
                        min="-100"
                        max="100"
                        value="0"
                        class="image-slider"
                        id="sharpness-slider"
                        oninput="updateEnhancement(this, 'sharpness')"
                      />
                    </div>

                    <div class="enhance-control">
                      <div
                        style="
                          display: flex;
                          justify-content: space-between;
                          margin-bottom: 8px;
                        "
                      >
                        <label style="color: #fff">Blacks</label>
                        <span class="value-display" id="blacks-value">0</span>
                      </div>
                      <input
                        type="range"
                        min="-100"
                        max="100"
                        value="0"
                        class="image-slider"
                        id="blacks-slider"
                        oninput="updateEnhancement(this, 'blacks')"
                      />
                    </div>

                    <div class="enhance-control">
                      <div
                        style="
                          display: flex;
                          justify-content: space-between;
                          margin-bottom: 8px;
                        "
                      >
                        <label style="color: #fff">Highlights</label>
                        <span class="value-display" id="highlights-value"
                          >0</span
                        >
                      </div>
                      <input
                        type="range"
                        min="-100"
                        max="100"
                        value="0"
                        class="image-slider"
                        id="highlights-slider"
                        oninput="updateEnhancement(this, 'highlights')"
                      />
                    </div>

                    <div
                      style="
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        gap: 20px;
                        margin-top: 30px;
                      "
                    >
                      <div
                        class="button-group"
                        style="
                          display: flex;
                          gap: 10px;
                          justify-content: center;
                          width: 100%;
                        "
                      >
                        <button
                          onclick="resetEnhancements()"
                          style="
                            background: rgba(255, 255, 255, 0.1);
                            color: #fff;
                            border: none;
                            padding: 8px 16px;
                            border-radius: 20px;
                            cursor: pointer;
                            display: flex;
                            align-items: center;
                            gap: 8px;
                          "
                        >
                          <span>↩️</span>
                          <span>Reset</span>
                        </button>
                        <button
                          onclick="applyEnhancements()"
                          style="
                            background: rgba(255, 255, 255, 0.1);
                            color: #fff;
                            border: none;
                            padding: 8px 16px;
                            border-radius: 20px;
                            cursor: pointer;
                            display: flex;
                            align-items: center;
                            gap: 8px;
                          "
                        >
                          <span>✅</span>
                          <span>Apply</span>
                        </button>
                      </div>
                      <div
                        style="
                          display: flex;
                          gap: 10px;
                          align-items: center;
                          margin: 15px 0;
                          padding: 0 20px;
                        "
                      >
                        <input
                          type="text"
                          id="enhance-filename"
                          placeholder="Enter filename (e.g. image.png)"
                          style="
                            flex: 1;
                            background: rgba(255, 255, 255, 0.1);
                            color: #fff;
                            border: none;
                            padding: 12px;
                            border-radius: 12px;
                          "
                        />
                        <button
                          id="download-enhanced"
                          style="
                            display: none;
                            background: rgba(255, 255, 255, 0.1);
                            color: #fff;
                            border: none;
                            padding: 12px 24px;
                            border-radius: 25px;
                            cursor: pointer;
                            font-size: 16px;
                            display: flex;
                            align-items: center;
                            gap: 10px;
                          "
                          onclick="downloadImage('enhance-canvas', document.getElementById('enhance-filename').value || 'enhanced.png')"
                        >
                          <span style="font-size: 20px">⬇️</span>
                          <span>Download</span>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <canvas id="enhance-canvas" style="display: none"></canvas>
            </div>

            <div class="tab-content" id="crop">
              <div class="crop-container">
                <div class="crop-area">
                  <div id="crop-overlay" class="crop-overlay">
                    <div class="crop-frame">
                      <div class="resize-handle top-left"></div>
                      <div class="resize-handle top-right"></div>
                      <div class="resize-handle bottom-left"></div>
                      <div class="resize-handle bottom-right"></div>
                      <div class="resize-handle top"></div>
                      <div class="resize-handle right"></div>
                      <div class="resize-handle bottom"></div>
                      <div class="resize-handle left"></div>
                      <div class="crop-grid">
                        <div class="grid-line horizontal"></div>
                        <div class="grid-line horizontal"></div>
                        <div class="grid-line vertical"></div>
                        <div class="grid-line vertical"></div>
                      </div>
                    </div>
                  </div>
                  <img id="crop-preview-image" class="crop-preview-image" />
                </div>
                <div class="crop-controls">
                  <button onclick="resetCrop()" class="icon-button">
                    <span>↺</span> Reset
                  </button>
                  <button onclick="applyCrop()" class="primary-button">
                    Apply Crop
                  </button>
                </div>
              </div>
              <canvas id="crop-canvas" style="display: none"></canvas>
              <div
                style="
                  display: flex;
                  gap: 10px;
                  align-items: center;
                  margin-top: 15px;
                "
              >
                <input
                  type="text"
                  id="crop-filename"
                  placeholder="Enter filename (e.g. image.png)"
                  style="flex: 1"
                />
                <button
                  id="download-crop"
                  style="display: none"
                  onclick="downloadImage('crop-canvas', document.getElementById('crop-filename').value || 'cropped.png')"
                  class="download-button"
                >
                  ⬇️ Download
                </button>
              </div>
            </div>
          </div>

          <!-- DEV TOOLS -->
          <div class="tool-section" id="dev-tools">
            <h2>🧑‍💻 Developer Tools</h2>

            <div class="tabs">
              <div class="tab active" data-tab="qr">QR Generator</div>
              <div class="tab" data-tab="color">Color Picker</div>
              <div class="tab" data-tab="lorem">Lorem Ipsum</div>
              <div class="tab" data-tab="regex">Regex Tester</div>
            </div>

            <div class="tab-content active" id="qr">
              <label>Enter text or URL:</label>
              <input
                type="text"
                id="qr-input"
                placeholder="https://example.com"
              />
              <button onclick="generateQR()">Generate QR Code</button>
              <div id="qr-output"></div>
              <button
                id="download-qr"
                style="display: none"
                onclick="downloadQR()"
              >
                ⬇️ Download QR
              </button>
            </div>

            <div class="tab-content" id="color">
              <label>Pick a color:</label>
              <input type="color" id="color-picker" value="#667eea" />
              <div id="color-preview" class="color-preview"></div>
              <div class="output-box" id="color-output"></div>
              <button onclick="updateColor()">Update Color Info</button>
            </div>

            <div class="tab-content" id="lorem">
              <label>Number of paragraphs:</label>
              <input
                type="number"
                id="lorem-count"
                value="3"
                min="1"
                max="10"
              />
              <button onclick="generateLorem()">Generate Lorem Ipsum</button>
              <textarea id="lorem-output" readonly></textarea>
              <button onclick="copyToClipboard('lorem-output')">📋 Copy</button>
            </div>

            <div class="tab-content" id="regex">
              <label>Regex Pattern:</label>
              <input
                type="text"
                id="regex-pattern"
                value="\\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Z|a-z]{2,}\\b"
              />
              <label>Test Text:</label>
              <textarea id="regex-text" placeholder="Enter text to test...">
Contact us at support@example.com or sales@company.org</textarea
              >
              <button onclick="testRegex()">Test Regex</button>
              <div id="regex-output"></div>
            </div>
          </div>

          <!-- SECURITY TOOLS -->
          <div class="tool-section" id="security-tools">
            <h2>🔐 Security & Encoding Tools</h2>

            <div class="tabs">
              <div class="tab active" data-tab="hash">Hash Generator</div>
              <div class="tab" data-tab="password">Password Gen</div>
              <div class="tab" data-tab="base64">Base64</div>
              <div class="tab" data-tab="jwt">JWT Decoder</div>
            </div>

            <div class="tab-content active" id="hash">
              <label>Enter text to hash:</label>
              <textarea id="hash-input" placeholder="Enter text..."></textarea>
              <button onclick="generateHashes()">Generate Hashes</button>
              <div id="hash-output"></div>
            </div>

            <div class="tab-content" id="password">
              <label
                >Password Length: <span id="pwd-length-val">16</span></label
              >
              <input
                type="range"
                id="pwd-length"
                min="8"
                max="64"
                value="16"
                style="width: 100%"
              />

              <div class="grid-2">
                <label
                  ><input type="checkbox" id="pwd-upper" checked />
                  Uppercase</label
                >
                <label
                  ><input type="checkbox" id="pwd-lower" checked />
                  Lowercase</label
                >
                <label
                  ><input type="checkbox" id="pwd-digits" checked />
                  Digits</label
                >
                <label
                  ><input type="checkbox" id="pwd-special" checked /> Special
                  Chars</label
                >
              </div>

              <button onclick="generatePassword()">Generate Password</button>
              <div class="output-box" id="password-output"></div>
              <button
                id="copy-pwd"
                style="display: none"
                onclick="copyPassword()"
              >
                📋 Copy Password
              </button>
            </div>

            <div class="tab-content" id="base64">
              <label>
                <input type="radio" name="base64-mode" value="encode" checked />
                Encode
                <input type="radio" name="base64-mode" value="decode" /> Decode
              </label>
              <textarea
                id="base64-input"
                placeholder="Enter text..."
              ></textarea>
              <button onclick="convertBase64()">Convert</button>
              <div class="output-box" id="base64-output"></div>
            </div>

            <div class="tab-content" id="jwt">
              <label>Enter JWT Token:</label>
              <textarea
                id="jwt-input"
                placeholder="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
              ></textarea>
              <button onclick="decodeJWT()">Decode JWT</button>
              <div id="jwt-output"></div>
            </div>
          </div>

          <!-- PRODUCTIVITY TOOLS -->
          <div class="tool-section" id="prod-tools">
            <h2>✅ Productivity Tools</h2>

            <div class="tabs">
              <div class="tab active" data-tab="todo">To-Do List</div>
              <div class="tab" data-tab="calendar">Calendar</div>
              <div class="tab" data-tab="habits">Habit Tracker</div>
              <div class="tab" data-tab="codes">QR/Barcode</div>
            </div>

            <div class="tab-content active" id="todo">
              <div class="card">
                <h3>📝 To-Do List & Notes</h3>
                <div class="form-group">
                  <input
                    type="text"
                    id="todo-input"
                    placeholder="Add a new task..."
                  />
                  <textarea
                    id="todo-note"
                    placeholder="Add notes (optional)..."
                    style="margin-top: 10px"
                  ></textarea>
                  <button
                    onclick="addTodoItem()"
                    class="btn-primary"
                    style="margin-top: 10px"
                  >
                    Add Task
                  </button>
                  <div
                    id="todo-list"
                    class="output-box"
                    style="margin-top: 20px"
                  ></div>
                </div>
              </div>
            </div>

            <div class="tab-content" id="calendar">
              <div class="card">
                <h3>📅 Calendar Reminders</h3>
                <div class="form-group">
                  <label>Event Title:</label>
                  <input
                    type="text"
                    id="event-title"
                    placeholder="Enter event title"
                  />
                  <label>Date & Time:</label>
                  <input type="datetime-local" id="event-datetime" />
                  <label>Reminder:</label>
                  <select id="reminder-time" class="compression-select">
                    <option value="5">5 minutes before</option>
                    <option value="15">15 minutes before</option>
                    <option value="30">30 minutes before</option>
                    <option value="60">1 hour before</option>
                    <option value="1440">1 day before</option>
                  </select>
                  <button onclick="addCalendarEvent()" class="btn-primary">
                    Add Event
                  </button>
                  <div
                    id="calendar-events"
                    class="output-box"
                    style="margin-top: 20px"
                  ></div>
                </div>
              </div>
            </div>

            <div class="tab-content" id="habits">
              <div class="card">
                <h3>🎯 Habit Tracker</h3>
                <div class="form-group">
                  <label>Habit Name:</label>
                  <input
                    type="text"
                    id="habit-name"
                    placeholder="Enter habit name"
                  />
                  <label>Goal:</label>
                  <select id="habit-frequency" class="compression-select">
                    <option value="daily">Daily</option>
                    <option value="weekly">Weekly</option>
                    <option value="monthly">Monthly</option>
                  </select>
                  <button onclick="addHabit()" class="btn-primary">
                    Add Habit
                  </button>
                  <div
                    id="habits-list"
                    class="output-box"
                    style="margin-top: 20px"
                  ></div>
                </div>
              </div>
            </div>

            <div class="tab-content" id="codes">
              <div class="card">
                <h3>📱 QR Code Generator</h3>
                <div class="form-group">
                  <label>Enter Text or URL:</label>
                  <input
                    type="text"
                    id="qr-text"
                    placeholder="Enter text or URL"
                  />
                  <button onclick="generateQRCode()" class="btn-primary">
                    Generate QR Code
                  </button>
                  <div
                    id="qr-output-prod"
                    class="output-box"
                    style="margin-top: 20px; text-align: center"
                  ></div>
                </div>
              </div>

              <div class="card">
                <h3>📊 Barcode Generator</h3>
                <div class="form-group">
                  <label>Barcode Type:</label>
                  <select id="barcode-type" class="compression-select">
                    <option value="ean13">EAN-13</option>
                    <option value="code128">Code 128</option>
                    <option value="code39">Code 39</option>
                    <option value="upc">UPC</option>
                  </select>
                  <label>Enter Value:</label>
                  <input
                    type="text"
                    id="barcode-value"
                    placeholder="Enter value"
                  />
                  <button onclick="generateBarcode()" class="btn-primary">
                    Generate Barcode
                  </button>
                  <div
                    id="barcode-output"
                    class="output-box"
                    style="margin-top: 20px; text-align: center"
                  ></div>
                </div>
              </div>
            </div>
          </div>

          <!-- TEXT TOOLS -->
          <div class="tool-section" id="text-tools">
            <h2>🔧 Text Utilities</h2>

            <div class="tabs">
              <div class="tab active" data-tab="case">Case Converter</div>
              <div class="tab" data-tab="counter">Word Counter</div>
              <div class="tab" data-tab="diff">Text Diff</div>
            </div>

            <div class="tab-content active" id="case">
              <textarea id="case-input" placeholder="Enter text...">
Hello World! This is a Test.</textarea
              >
              <button onclick="convertCase()">Convert Cases</button>
              <div class="grid-2">
                <div class="card">
                  <h4>UPPERCASE</h4>
                  <div class="output-box" id="case-upper"></div>
                </div>
                <div class="card">
                  <h4>lowercase</h4>
                  <div class="output-box" id="case-lower"></div>
                </div>
                <div class="card">
                  <h4>Title Case</h4>
                  <div class="output-box" id="case-title"></div>
                </div>
                <div class="card">
                  <h4>Sentence case</h4>
                  <div class="output-box" id="case-sentence"></div>
                </div>
              </div>
            </div>

            <div class="tab-content" id="counter">
              <textarea
                id="counter-input"
                placeholder="Enter text to count..."
              ></textarea>
              <button onclick="countWords()">Count Words & Characters</button>
              <div class="grid-2">
                <div class="metric">
                  <span class="metric-value" id="word-count">0</span>
                  <span class="metric-label">Words</span>
                </div>
                <div class="metric">
                  <span class="metric-value" id="char-count">0</span>
                  <span class="metric-label">Characters</span>
                </div>
                <div class="metric">
                  <span class="metric-value" id="char-no-space">0</span>
                  <span class="metric-label">Chars (no spaces)</span>
                </div>
                <div class="metric">
                  <span class="metric-value" id="line-count">0</span>
                  <span class="metric-label">Lines</span>
                </div>
              </div>
            </div>

            <div class="tab-content" id="diff">
              <div class="grid-2">
                <div>
                  <label>Original Text:</label>
                  <textarea
                    id="diff-text1"
                    placeholder="Original text..."
                  ></textarea>
                </div>
                <div>
                  <label>Modified Text:</label>
                  <textarea
                    id="diff-text2"
                    placeholder="Modified text..."
                  ></textarea>
                </div>
              </div>
              <button onclick="compareDiff()">Compare Texts</button>
              <div id="diff-output"></div>
            </div>
          </div>

          <!-- UTILITY CALCULATORS -->
          <div class="tool-section" id="calc-tools">
            <h2>🧮 Utility Calculators</h2>

            <div class="tabs">
              <div class="tab active" data-tab="calc-bmi">BMI Calculator</div>
              <div class="tab" data-tab="calc-age">Age Calculator</div>
              <div class="tab" data-tab="calc-emi">Loan/EMI</div>
              <div class="tab" data-tab="calc-currency">Currency</div>
              <div class="tab" data-tab="calc-unit">Unit Converter</div>
              <div class="tab" data-tab="calc-discount">Discount</div>
            </div>

            <div class="tab-content active" id="calc-bmi">
              <div class="card">
                <h3>💪 BMI Calculator</h3>
                <div class="form-group">
                  <label>Height:</label>
                  <div style="display: flex; gap: 10px; align-items: center">
                    <input
                      type="number"
                      id="height-cm"
                      placeholder="Height in cm"
                      style="flex: 1"
                    />
                    <span>cm</span>
                  </div>
                  <label>Weight:</label>
                  <div style="display: flex; gap: 10px; align-items: center">
                    <input
                      type="number"
                      id="weight-kg"
                      placeholder="Weight in kg"
                      style="flex: 1"
                    />
                    <span>kg</span>
                  </div>
                  <button onclick="calculateBMI()" class="btn-primary">
                    Calculate BMI
                  </button>
                  <div
                    id="bmi-result"
                    class="output-box"
                    style="display: none"
                  ></div>
                </div>
              </div>
            </div>

            <div class="tab-content" id="calc-age">
              <div class="card">
                <h3>🎂 Age Calculator</h3>
                <div class="form-group">
                  <label>Date of Birth:</label>
                  <input type="date" id="dob" />
                  <button onclick="calculateAge()" class="btn-primary">
                    Calculate Age
                  </button>
                  <div
                    id="age-result"
                    class="output-box"
                    style="display: none"
                  ></div>
                </div>
              </div>
            </div>

            <div class="tab-content" id="calc-emi">
              <div class="card">
                <h3>💰 Loan/EMI Calculator</h3>
                <div class="form-group">
                  <label>Loan Amount:</label>
                  <input
                    type="number"
                    id="loan-amount"
                    placeholder="Enter loan amount"
                  />
                  <label>Interest Rate (% per year):</label>
                  <input
                    type="number"
                    id="interest-rate"
                    placeholder="Enter interest rate"
                  />
                  <label>Loan Term (years):</label>
                  <input
                    type="number"
                    id="loan-term"
                    placeholder="Enter loan term"
                  />
                  <button onclick="calculateEMI()" class="btn-primary">
                    Calculate EMI
                  </button>
                  <div
                    id="emi-result"
                    class="output-box"
                    style="display: none"
                  ></div>
                </div>
              </div>
            </div>

            <div class="tab-content" id="calc-currency">
              <div class="card">
                <h3>💱 Currency Converter</h3>
                <div class="form-group">
                  <label>Amount:</label>
                  <input
                    type="number"
                    id="currency-amount"
                    placeholder="Enter amount"
                  />
                  <label>From:</label>
                  <select
                    id="currency-from"
                    class="compression-select"
                  ></select>
                  <label>To:</label>
                  <select id="currency-to" class="compression-select"></select>
                  <button onclick="convertCurrency()" class="btn-primary">
                    Convert
                  </button>
                  <div
                    id="currency-result"
                    class="output-box"
                    style="display: none"
                  ></div>
                </div>
              </div>
            </div>

            <div class="tab-content" id="calc-unit">
              <div class="card">
                <h3>📏 Unit Converter</h3>
                <div class="form-group">
                  <label>Category:</label>
                  <select id="unit-category" class="compression-select">
                    <option value="length">Length</option>
                    <option value="weight">Weight</option>
                    <option value="temp">Temperature</option>
                    <option value="area">Area</option>
                    <option value="volume">Volume</option>
                  </select>
                  <label>Value:</label>
                  <input
                    type="number"
                    id="unit-value"
                    placeholder="Enter value"
                  />
                  <label>From:</label>
                  <select id="unit-from" class="compression-select"></select>
                  <label>To:</label>
                  <select id="unit-to" class="compression-select"></select>
                  <button onclick="convertUnit()" class="btn-primary">
                    Convert
                  </button>
                  <div
                    id="unit-result"
                    class="output-box"
                    style="display: none"
                  ></div>
                </div>
              </div>
            </div>

            <div class="tab-content" id="calc-discount">
              <div class="card">
                <h3>🏷️ Discount Calculator</h3>
                <div class="form-group">
                  <label>Original Price:</label>
                  <input
                    type="number"
                    id="original-price"
                    placeholder="Enter original price"
                  />
                  <label>Discount (%):</label>
                  <input
                    type="number"
                    id="discount-percent"
                    placeholder="Enter discount percentage"
                  />
                  <button onclick="calculateDiscount()" class="btn-primary">
                    Calculate
                  </button>
                  <div
                    id="discount-result"
                    class="output-box"
                    style="display: none"
                  ></div>
                </div>
              </div>
            </div>
          </div>

          <!-- TIME TOOLS -->
          <div class="tool-section" id="time-tools">
            <h2>⏰ Time & Date Tools</h2>

            <div class="tabs">
              <div class="tab active" data-tab="timestamp">Timestamp</div>
              <div class="tab" data-tab="date-calc">Date Calculator</div>
            </div>

            <div class="tab-content active" id="timestamp">
              <div class="card">
                <h3>Current Timestamp</h3>
                <div class="output-box" id="current-timestamp"></div>
                <button onclick="updateTimestamp()">Refresh</button>
              </div>

              <div class="card">
                <h3>Convert Timestamp</h3>
                <input
                  type="number"
                  id="timestamp-input"
                  placeholder="Enter Unix timestamp"
                />
                <button onclick="convertTimestamp()">Convert</button>
                <div id="timestamp-output"></div>
              </div>
            </div>

            <div class="tab-content" id="date-calc">
              <div class="grid-2">
                <div>
                  <label>Start Date:</label>
                  <input type="date" id="start-date" />
                </div>
                <div>
                  <label>End Date:</label>
                  <input type="date" id="end-date" />
                </div>
              </div>
              <button onclick="calculateDateDiff()">
                Calculate Difference
              </button>
              <div id="date-diff-output"></div>
            </div>
          </div>

          <!-- CODE TOOLS -->
          <div class="tool-section" id="code-tools">
            <h2>💻 Code Formatter & Viewer</h2>

            <label>Language:</label>
            <select id="code-lang">
              <option value="json">JSON</option>
              <option value="javascript">JavaScript</option>
              <option value="python">Python</option>
              <option value="html">HTML</option>
              <option value="css">CSS</option>
              <option value="xml">XML</option>
              <option value="sql">SQL</option>
            </select>

            <textarea
              id="code-input"
              placeholder="Paste your code here..."
              style="font-family: monospace; min-height: 300px"
            ></textarea>

            <div class="btn-group">
              <button onclick="formatCode()">✨ Format Code</button>
              <button onclick="minifyCode()" class="btn-secondary">
                🗜️ Minify
              </button>
              <button onclick="beautifyCode()" class="btn-success">
                🎨 Beautify
              </button>
              <button onclick="copyCode()">📋 Copy</button>
            </div>

            <div id="code-stats" style="display: none; margin: 15px 0">
              <div class="stats-grid">
                <div class="stat-card">
                  <div class="stat-number" id="lines-count">0</div>
                  <div class="stat-label">Lines</div>
                </div>
                <div class="stat-card">
                  <div class="stat-number" id="chars-count">0</div>
                  <div class="stat-label">Characters</div>
                </div>
                <div class="stat-card">
                  <div class="stat-number" id="size-count">0</div>
                  <div class="stat-label">Size</div>
                </div>
              </div>
            </div>

            <div id="code-output"></div>
          </div>

          <!-- PDF TOOLS -->
          <div class="tool-section" id="pdf-tools">
            <h2>📄 PDF Tools</h2>

            <!-- Shared PDF Input -->
            <div class="card" style="margin-bottom: 20px">
              <h3>📁 Select PDF File</h3>
              <input type="file" id="shared-pdf-input" accept=".pdf" />
              <div id="pdf-status" style="margin: 15px 0; display: none">
                <div class="alert alert-success">
                  <strong>✅ PDF Loaded:</strong> <span id="pdf-filename"></span
                  ><br />
                  <strong>📄 Pages:</strong> <span id="pdf-pages"></span> |
                  <strong>📦 Size:</strong> <span id="pdf-size"></span>
                </div>
              </div>
            </div>

            <div class="tabs">
              <div class="tab active" data-tab="pdf-info">PDF Info</div>
              <div class="tab" data-tab="pdf-preview">Preview Pages</div>
              <div class="tab" data-tab="pdf-text">Extract Text</div>
              <div class="tab" data-tab="pdf-resize">Resize PDF</div>
              <div class="tab" data-tab="pdf-merge">Merge PDFs</div>
              <div class="tab" data-tab="pdf-split">Split PDF</div>
              <div class="tab" data-tab="pdf-convert">Convert Format</div>
            </div>

            <!-- PDF Info -->
            <div class="tab-content active" id="pdf-info">
              <button onclick="analyzePDF()">📊 Analyze Current PDF</button>
              <div id="pdf-info-output"></div>
            </div>

            <!-- Preview Pages -->
            <div class="tab-content" id="pdf-preview">
              <button onclick="previewPDF()">👁️ Preview Current PDF</button>
              <div class="loader" id="pdf-loader"></div>
              <div class="pdf-navigation">
                <button onclick="previousPage()" id="prev-page" disabled>
                  ◀ Previous
                </button>
                <span class="pdf-page-info">
                  Page <span id="current-page">1</span> of
                  <span id="total-pages">0</span>
                </span>
                <button onclick="nextPage()" id="next-page" disabled>
                  Next ▶
                </button>
                <button
                  onclick="downloadCurrentPage()"
                  id="download-page"
                  style="display: none"
                >
                  ⬇️ Download Page
                </button>
              </div>
              <div
                id="pdf-canvas-container"
                style="text-align: center; margin: 20px 0"
              >
                <canvas
                  id="pdf-canvas"
                  style="border: 1px solid #ddd; max-width: 100%"
                ></canvas>
              </div>
            </div>

            <!-- Format Converter -->
            <div class="tab-content" id="pdf-convert">
              <div
                class="card"
                style="
                  margin-bottom: 20px;
                  background: rgba(255, 255, 255, 0.05);
                  border-radius: 12px;
                "
              >
                <h3 style="display: flex; align-items: center; gap: 8px">
                  <span style="font-size: 20px">🔄</span>
                  <span>Convert Format</span>
                </h3>
                <div class="control-group">
                  <div style="margin-bottom: 20px">
                    <label style="display: block; margin-bottom: 8px"
                      >Convert From:</label
                    >
                    <select
                      id="convert-from"
                      class="small-input"
                      style="
                        background: rgba(255, 255, 255, 0.1);
                        border: none;
                        border-radius: 8px;
                        padding: 8px 12px;
                        width: 100%;
                        color: #fff;
                      "
                    >
                      <option value="pdf">PDF</option>
                      <option value="doc">WORD</option>
                      <option value="ppt">POWERPOINT</option>
                      <option value="xls">EXCEL</option>
                      <option value="jpg">JPG/JPEG</option>
                      <option value="html">HTML</option>
                    </select>
                  </div>
                  <div style="margin-bottom: 20px">
                    <label style="display: block; margin-bottom: 8px"
                      >Convert To:</label
                    >
                    <select
                      id="convert-to"
                      class="small-input"
                      style="
                        background: rgba(255, 255, 255, 0.1);
                        border: none;
                        border-radius: 8px;
                        padding: 8px 12px;
                        width: 100%;
                        color: #fff;
                      "
                    >
                      <option value="pdf">PDF</option>
                      <option value="pdfa">PDF/A</option>
                      <option value="doc">WORD</option>
                      <option value="ppt">POWERPOINT</option>
                      <option value="xls">EXCEL</option>
                      <option value="jpg">JPG/JPEG</option>
                      <option value="html">HTML</option>
                    </select>
                  </div>
                  <div style="margin-bottom: 20px">
                    <label style="display: block; margin-bottom: 8px"
                      >File to Convert:</label
                    >
                    <div
                      style="
                        background: rgba(255, 255, 255, 0.1);
                        border-radius: 8px;
                        padding: 12px;
                      "
                    >
                      <input
                        type="file"
                        id="convert-file-input"
                        style="color: #fff"
                      />
                      <small
                        style="display: block; margin-top: 8px; color: #888"
                      >
                        Select a file in the "Convert From" format
                      </small>
                    </div>
                  </div>
                  <button
                    onclick="convertFormat()"
                    style="
                      background: rgba(255, 255, 255, 0.1);
                      color: #fff;
                      border: none;
                      padding: 10px 20px;
                      border-radius: 20px;
                      cursor: pointer;
                      display: flex;
                      align-items: center;
                      gap: 8px;
                      width: 100%;
                      justify-content: center;
                    "
                  >
                    <span style="font-size: 16px">🔄</span>
                    <span>Convert File</span>
                  </button>
                </div>
              </div>
              <div
                class="loader"
                id="convert-loader"
                style="margin: 20px 0"
              ></div>
              <div id="convert-output"></div>
            </div>

            <!-- Extract Text -->
            <div class="tab-content" id="pdf-text">
              <button onclick="extractPDFText()">
                📝 Extract Text from Current PDF
              </button>
              <div class="loader" id="text-loader"></div>
              <div id="pdf-text-output"></div>
            </div>

            <!-- PDF Resize -->
            <div class="tab-content" id="pdf-resize">
              <div class="card">
                <h3>📏 Resize PDF</h3>
                <div class="control-group">
                  <div style="margin-bottom: 15px">
                    <label>Resize Mode:</label>
                    <select
                      id="pdf-resize-mode"
                      class="small-input"
                      onchange="togglePdfResizeMode()"
                    >
                      <option value="dimensions">By Dimensions</option>
                      <option value="filesize">By File Size</option>
                    </select>
                  </div>

                  <div id="pdf-dimensions-controls">
                    <label>Scale (%):</label>
                    <input
                      type="number"
                      id="pdf-scale"
                      value="100"
                      class="small-input"
                      min="1"
                      max="200"
                    />
                    <small style="display: block; margin-top: 5px; color: #666">
                      Scales the PDF pages. 100% = original size, 50% = half
                      size, etc.
                    </small>
                  </div>

                  <div id="pdf-filesize-controls" style="display: none">
                    <label>Target File Size:</label>
                    <div style="display: flex; gap: 10px; align-items: center">
                      <input
                        type="number"
                        id="pdf-target-size"
                        value="200"
                        class="small-input"
                        style="flex: 1"
                      />
                      <select
                        id="pdf-size-unit"
                        class="small-input"
                        style="width: auto"
                      >
                        <option value="KB">KB</option>
                        <option value="MB">MB</option>
                      </select>
                    </div>
                    <div
                      class="file-info"
                      style="margin-top: 10px; font-size: 0.9em"
                    >
                      Current size: <span id="current-pdf-size">-</span>
                    </div>
                  </div>

                  <button
                    onclick="resizePDF()"
                    class="compact-button"
                    style="margin-top: 15px"
                  >
                    🔄 Apply Resize
                  </button>
                </div>
              </div>
              <div class="loader" id="resize-loader"></div>
              <div id="pdf-resize-output"></div>
            </div>

            <!-- Merge PDFs -->
            <div class="tab-content" id="pdf-merge">
              <div class="card" style="margin-bottom: 20px">
                <h3>📑 PDF Merge Options</h3>
                <div style="margin: 15px 0">
                  <label>
                    <input
                      type="radio"
                      name="merge-mode"
                      value="multiple"
                      checked
                    />
                    Merge multiple PDF files
                  </label>
                  <br />
                  <label>
                    <input
                      type="radio"
                      name="merge-mode"
                      value="with-current"
                    />
                    Include current PDF with additional files
                  </label>
                </div>
              </div>

              <div id="merge-multiple" class="merge-option">
                <div class="alert alert-info">
                  Select multiple PDF files to merge them into one document
                </div>
                <input
                  type="file"
                  id="pdf-merge-input"
                  accept=".pdf"
                  multiple
                />
                <button onclick="mergePDFs()">📑 Merge Selected PDFs</button>
              </div>

              <div
                id="merge-with-current"
                class="merge-option"
                style="display: none"
              >
                <div class="alert alert-info">
                  The current PDF will be included as the first document in the
                  merge
                </div>
                <input
                  type="file"
                  id="pdf-additional-input"
                  accept=".pdf"
                  multiple
                />
                <button onclick="mergeWithCurrent()">
                  📑 Merge Current + Additional PDFs
                </button>
              </div>

              <div class="loader" id="merge-loader"></div>
              <div id="pdf-merge-output"></div>
            </div>

            <!-- Split PDF -->
            <div class="tab-content" id="pdf-split">
              <button onclick="showSplitOptions()">✂️ Split Current PDF</button>
              <div id="split-options" style="display: none; margin: 20px 0">
                <div class="card">
                  <h3>Split Options</h3>
                  <label>
                    <input
                      type="radio"
                      name="split-mode"
                      value="range"
                      checked
                    />
                    Extract Page Range
                  </label>
                  <div id="range-options" style="margin: 15px 0">
                    <div class="grid-2">
                      <div>
                        <label>From Page:</label>
                        <input
                          type="number"
                          id="split-from"
                          min="1"
                          value="1"
                        />
                      </div>
                      <div>
                        <label>To Page:</label>
                        <input type="number" id="split-to" min="1" value="1" />
                      </div>
                    </div>
                  </div>
                  <label>
                    <input type="radio" name="split-mode" value="individual" />
                    Split into Individual Pages
                  </label>
                </div>
                <button onclick="splitPDF()">Split PDF</button>
              </div>
              <div class="loader" id="split-loader"></div>
              <div id="pdf-split-output"></div>
            </div>
          </div>

          <!-- AUDIO/VIDEO TOOLS -->
          <div class="tool-section" id="av-tools">
            <h2>🎵 Audio/Video Tools</h2>

            <div class="tabs">
              <div class="tab active" data-tab="audio">Audio Tools</div>
              <div class="tab" data-tab="video">Video Tools</div>
            </div>

            <div class="tab-content active" id="audio">
              <div class="card">
                <h3>🎵 MP3 Cutter/Merger</h3>
                <div class="form-group">
                  <label>Upload Audio File:</label>
                  <input
                    type="file"
                    accept=".mp3"
                    class="file-input"
                    id="audio-input"
                  />
                </div>
                <div
                  class="form-group"
                  id="audio-controls"
                  style="display: none"
                >
                  <div class="control-group">
                    <label>Start Time:</label>
                    <input type="time" step="1" id="audio-start" />
                    <label>End Time:</label>
                    <input type="time" step="1" id="audio-end" />
                  </div>
                  <button onclick="cutAudio()" class="btn-primary">
                    ✂️ Cut Audio
                  </button>
                </div>
                <div
                  class="form-group"
                  id="audio-merge"
                  style="margin-top: 20px"
                >
                  <h4>Merge Audio Files</h4>
                  <input
                    type="file"
                    accept=".mp3"
                    multiple
                    class="file-input"
                    id="merge-audio-input"
                  />
                  <button onclick="mergeAudio()" class="btn-primary">
                    🔄 Merge Files
                  </button>
                </div>
              </div>

              <div class="card">
                <h3>🔄 Audio Converter</h3>
                <div class="form-group">
                  <label>Upload Audio File:</label>
                  <input
                    type="file"
                    accept=".mp3,.wav,.aac,.m4a"
                    class="file-input"
                    id="convert-audio-input"
                  />
                  <label>Convert To:</label>
                  <select id="audio-format" class="compression-select">
                    <option value="mp3">MP3</option>
                    <option value="wav">WAV</option>
                    <option value="aac">AAC</option>
                  </select>
                  <div style="margin-top: 10px">
                    <button onclick="convertAudio()" class="btn-primary">
                      🔄 Convert
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <div class="tab-content" id="video">
              <div class="card">
                <h3>🎥 Video to MP3</h3>
                <div class="form-group">
                  <label>Upload Video File:</label>
                  <input
                    type="file"
                    accept="video/*"
                    class="file-input"
                    id="video-to-mp3-input"
                  />
                  <div style="margin-top: 10px">
                    <button onclick="convertVideoToMP3()" class="btn-primary">
                      🔄 Extract Audio
                    </button>
                  </div>
                </div>
              </div>

              <div class="card">
                <h3>📹 Video Compressor</h3>
                <div class="form-group">
                  <label>Upload Video File:</label>
                  <input
                    type="file"
                    accept="video/*"
                    class="file-input"
                    id="compress-video-input"
                  />
                  <label>Quality:</label>
                  <select id="video-quality" class="compression-select">
                    <option value="high">High Quality (Slower)</option>
                    <option value="medium">Medium Quality</option>
                    <option value="low">Low Quality (Faster)</option>
                  </select>
                  <div style="margin-top: 10px">
                    <button onclick="compressVideo()" class="btn-primary">
                      🔄 Compress
                    </button>
                  </div>
                </div>
              </div>

              <div class="card">
                <h3>📝 Subtitles Generator</h3>
                <div class="form-group">
                  <label>Upload Video File:</label>
                  <input
                    type="file"
                    accept="video/*"
                    class="file-input"
                    id="subtitle-video-input"
                  />
                  <label>Language:</label>
                  <select id="subtitle-language" class="compression-select">
                    <option value="en">English</option>
                    <option value="es">Spanish</option>
                    <option value="fr">French</option>
                    <option value="de">German</option>
                  </select>
                  <div style="margin-top: 10px">
                    <button onclick="generateSubtitles()" class="btn-primary">
                      🔄 Generate Subtitles
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- ZIP TOOLS -->
          <div class="tool-section" id="zip-tools">
            <h2>📦 ZIP Tools</h2>

            <div class="tabs">
              <div class="tab active" data-tab="compress">Compress</div>
              <div class="tab" data-tab="extract">Extract</div>
            </div>

            <div class="tab-content active" id="compress">
              <div class="card">
                <h3>Create ZIP Archive</h3>
                <div class="compress-options">
                  <div class="form-group">
                    <label>Add Files:</label>
                    <input
                      type="file"
                      id="zip-files"
                      multiple
                      class="file-input"
                    />
                  </div>

                  <div class="form-group">
                    <label>Output File Name:</label>
                    <input
                      type="text"
                      id="zip-filename"
                      placeholder="archive.zip"
                      class="text-input"
                    />
                  </div>

                  <div class="form-group">
                    <label>Compression Level:</label>
                    <select id="compression-level" class="compression-select">
                      <option value="0">Store (No Compression)</option>
                      <option value="1">Very Low Compression</option>
                      <option value="5" selected>Normal Compression</option>
                      <option value="7">High Compression</option>
                      <option value="9">Maximum Compression</option>
                    </select>
                  </div>

                  <div class="form-group">
                    <label>Encryption Options:</label>
                    <div class="encryption-options">
                      <div class="radio-group">
                        <label>
                          <input
                            type="radio"
                            name="encryption"
                            value="none"
                            checked
                          />
                          No Encryption
                        </label>
                        <label>
                          <input
                            type="radio"
                            name="encryption"
                            value="aes128"
                          />
                          AES-128
                        </label>
                        <label>
                          <input
                            type="radio"
                            name="encryption"
                            value="aes256"
                          />
                          AES-256 (Strongest)
                        </label>
                      </div>
                      <input
                        type="password"
                        id="zip-password"
                        placeholder="Enter encryption password"
                        disabled
                        class="password-input"
                      />
                      <div
                        class="password-strength"
                        id="password-strength"
                      ></div>
                    </div>
                  </div>

                  <div class="selected-files" id="selected-files-list">
                    <div class="file-list-header">Selected Files:</div>
                    <div class="file-list-content"></div>
                  </div>

                  <button
                    onclick="createZip()"
                    class="btn-primary"
                    id="create-zip-btn"
                  >
                    Create ZIP
                  </button>
                </div>
              </div>
            </div>

            <div class="tab-content" id="extract">
              <div class="card">
                <h3>Extract ZIP Archive</h3>
                <div class="extract-options">
                  <div class="form-group">
                    <label>Select ZIP File:</label>
                    <input
                      type="file"
                      id="zip-extract"
                      accept=".zip"
                      class="file-input"
                    />
                  </div>

                  <div class="form-group">
                    <label>Output Folder Name:</label>
                    <input
                      type="text"
                      id="extract-foldername"
                      placeholder="extracted_files"
                      class="text-input"
                    />
                  </div>

                  <div class="form-group">
                    <label>Encryption Type:</label>
                    <select id="decrypt-type" class="encryption-select">
                      <option value="auto">Auto-detect</option>
                      <option value="aes128">AES-128</option>
                      <option value="aes256">AES-256</option>
                      <option value="zip">Standard ZIP</option>
                    </select>
                    <input
                      type="password"
                      id="extract-password"
                      placeholder="Enter password if protected"
                      class="password-input"
                    />
                  </div>

                  <div class="form-group">
                    <label>ZIP Repair Options:</label>
                    <div class="repair-options">
                      <label class="checkbox-label">
                        <input type="checkbox" id="repair-corrupted" />
                        Attempt to repair corrupted files
                      </label>
                      <label class="checkbox-label">
                        <input type="checkbox" id="ignore-crc" />
                        Ignore CRC errors
                      </label>
                      <label class="checkbox-label">
                        <input type="checkbox" id="recover-headers" />
                        Recover damaged headers
                      </label>
                    </div>
                  </div>

                  <div class="zip-contents" id="zip-contents">
                    <div class="file-list-header">ZIP Contents:</div>
                    <div class="file-list-content"></div>
                  </div>

                  <button
                    onclick="extractZip()"
                    class="btn-primary"
                    id="extract-zip-btn"
                  >
                    Extract ZIP
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- ABOUT -->
          <div class="tool-section" id="about">
            <h2>ℹ️ About Developer Toolbox</h2>
            <div class="card">
              <h3>🧰 Developer Toolbox - Web Edition</h3>
              <p>
                A comprehensive collection of developer utilities converted to a
                modern web application.
              </p>

              <h4>Features:</h4>
              <ul style="line-height: 2">
                <li>🏞️ Image Tools - Resize, enhance, and crop images</li>
                <li>💻 Code Tools - Format and minify code</li>
                <li>
                  🧑‍💻 Developer Tools - QR codes, color picker, Lorem Ipsum,
                  regex tester
                </li>
                <li>
                  🔐 Security Tools - Hash generation, password generation,
                  Base64, JWT decoder
                </li>
                <li>
                  🔧 Text Utilities - Case conversion, word counter, text diff
                </li>
                <li>
                  ⏰ Time & Date Tools - Timestamp conversion, date calculations
                </li>
              </ul>

              <h4>Technology Stack:</h4>
              <p>Pure HTML, CSS, and JavaScript - No frameworks required!</p>

              <div
                style="
                  margin-top: 30px;
                  padding: 20px;
                  background: linear-gradient(
                    135deg,
                    var(--primary),
                    var(--secondary)
                  );
                  color: white;
                  border-radius: 10px;
                "
              >
                <h3>👨‍💻 Created by devchauhann</h3>
                <p>
                  ⭐ Star on
                  <a href="https://github.com/devchauhann" style="color: white"
                    >GitHub</a
                  >
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <footer>
        <p>
          Toolzap | Created with ❤️ by
          <a href="https://github.com/devchauhann">devchauhann</a>
        </p>
      </footer>
    </div>

    <script>
      // Global variables
      let uploadedImage = null;
      let qrCodeInstance = null;

      // Audio Context and Variables
      let audioContext;
      let audioBuffers = [];

      // Initialize Audio Context with user interaction
      function initAudioContext() {
        if (!audioContext) {
          audioContext = new (window.AudioContext ||
            window.webkitAudioContext)();
        }
        return audioContext;
      }

      // Convert File to AudioBuffer
      async function fileToAudioBuffer(file) {
        const arrayBuffer = await file.arrayBuffer();
        return await audioContext.decodeAudioData(arrayBuffer);
      }

      // Export AudioBuffer to File
      function exportAudioBuffer(audioBuffer, format = "audio/wav") {
        return new Promise((resolve, reject) => {
          const offlineContext = new OfflineAudioContext(
            audioBuffer.numberOfChannels,
            audioBuffer.length,
            audioBuffer.sampleRate
          );

          const source = offlineContext.createBufferSource();
          source.buffer = audioBuffer;
          source.connect(offlineContext.destination);
          source.start();

          offlineContext
            .startRendering()
            .then((renderedBuffer) => {
              const wav = audioBufferToWav(renderedBuffer);
              const blob = new Blob([wav], { type: format });
              resolve(blob);
            })
            .catch(reject);
        });
      }

      // Audio/Video Tools Functions
      async function cutAudio() {
        try {
          const audioInput = document.getElementById("audio-input");
          if (!audioInput.files[0]) {
            showAlert("Please select an audio file first!", "error");
            return;
          }

          const startTime = document.getElementById("audio-start").value;
          const endTime = document.getElementById("audio-end").value;

          if (!startTime || !endTime) {
            showAlert("Please specify both start and end times!", "error");
            return;
          }

          const start = timeStringToSeconds(startTime);
          const end = timeStringToSeconds(endTime);

          if (start >= end) {
            showAlert("End time must be after start time!", "error");
            return;
          }

          initAudioContext();
          showAlert("Processing audio...", "info");

          const audioBuffer = await fileToAudioBuffer(audioInput.files[0]);

          // Create new buffer for the cut portion
          const startSample = Math.floor(start * audioBuffer.sampleRate);
          const endSample = Math.floor(end * audioBuffer.sampleRate);
          const newBuffer = audioContext.createBuffer(
            audioBuffer.numberOfChannels,
            endSample - startSample,
            audioBuffer.sampleRate
          );

          // Copy the selected portion
          for (
            let channel = 0;
            channel < audioBuffer.numberOfChannels;
            channel++
          ) {
            const newData = newBuffer.getChannelData(channel);
            const originalData = audioBuffer.getChannelData(channel);
            for (let i = 0; i < newBuffer.length; i++) {
              newData[i] = originalData[i + startSample];
            }
          }

          // Export the cut audio
          const blob = await exportAudioBuffer(newBuffer);
          const url = URL.createObjectURL(blob);

          // Create download link
          const a = document.createElement("a");
          a.href = url;
          a.download = "cut_audio.wav";
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);

          showAlert("Audio cut successfully!", "success");
        } catch (error) {
          showAlert("Error cutting audio: " + error.message, "error");
        }
      }

      async function mergeAudio() {
        try {
          const audioInput = document.getElementById("merge-audio-input");
          if (!audioInput.files.length || audioInput.files.length < 2) {
            showAlert(
              "Please select at least 2 audio files to merge!",
              "error"
            );
            return;
          }

          initAudioContext();
          showAlert("Processing audio files...", "info");

          // Convert all files to audio buffers
          const buffers = await Promise.all(
            Array.from(audioInput.files).map((file) => fileToAudioBuffer(file))
          );

          // Calculate total length and max channels
          let totalLength = 0;
          let maxChannels = 0;
          buffers.forEach((buffer) => {
            totalLength += buffer.length;
            maxChannels = Math.max(maxChannels, buffer.numberOfChannels);
          });

          // Create new buffer for merged audio
          const mergedBuffer = audioContext.createBuffer(
            maxChannels,
            totalLength,
            audioContext.sampleRate
          );

          // Merge buffers
          let offset = 0;
          for (const buffer of buffers) {
            for (
              let channel = 0;
              channel < buffer.numberOfChannels;
              channel++
            ) {
              const mergedData = mergedBuffer.getChannelData(channel);
              const bufferData = buffer.getChannelData(channel);
              for (let i = 0; i < buffer.length; i++) {
                mergedData[i + offset] = bufferData[i];
              }
            }
            offset += buffer.length;
          }

          // Export merged audio
          const blob = await exportAudioBuffer(mergedBuffer);
          const url = URL.createObjectURL(blob);

          // Create download link
          const a = document.createElement("a");
          a.href = url;
          a.download = "merged_audio.wav";
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);

          showAlert("Audio files merged successfully!", "success");
        } catch (error) {
          showAlert("Error merging audio: " + error.message, "error");
        }
      }

      async function convertAudio() {
        try {
          const audioInput = document.getElementById("convert-audio-input");
          if (!audioInput.files[0]) {
            showAlert("Please select an audio file to convert!", "error");
            return;
          }

          const format = document.getElementById("audio-format").value;
          const mimeType = `audio/${format}`;

          initAudioContext();
          showAlert("Converting audio...", "info");

          // Load and decode audio
          const audioBuffer = await fileToAudioBuffer(audioInput.files[0]);

          // Create MediaStream from AudioBuffer
          const streamDestination = audioContext.createMediaStreamDestination();
          const source = audioContext.createBufferSource();
          source.buffer = audioBuffer;
          source.connect(streamDestination);
          source.start();

          // Create MediaRecorder with desired format
          const mediaRecorder = new MediaRecorder(streamDestination.stream, {
            mimeType: MediaRecorder.isTypeSupported(mimeType)
              ? mimeType
              : "audio/webm",
          });

          const chunks = [];
          mediaRecorder.ondataavailable = (e) => chunks.push(e.data);
          mediaRecorder.onstop = () => {
            const blob = new Blob(chunks, { type: mimeType });
            const url = URL.createObjectURL(blob);

            // Create download link
            const a = document.createElement("a");
            a.href = url;
            a.download = `converted_audio.${format}`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showAlert(
              `Audio converted to ${format.toUpperCase()} format!`,
              "success"
            );
          };

          mediaRecorder.start();
          setTimeout(
            () => mediaRecorder.stop(),
            audioBuffer.duration * 1000 + 100
          );
        } catch (error) {
          showAlert("Error converting audio: " + error.message, "error");
        }
      }

      // Helper function to convert AudioBuffer to WAV format
      function audioBufferToWav(buffer) {
        const numOfChan = buffer.numberOfChannels;
        const length = buffer.length * numOfChan * 2;
        const buffer16Bit = new Int16Array(length);
        const data = buffer.getChannelData(0);
        let offset = 0;

        for (let i = 0; i < buffer.length; i++) {
          const sample = data[i];
          buffer16Bit[offset++] =
            sample < 0 ? sample * 0x8000 : sample * 0x7fff;
        }

        const wavBytes = new Uint8Array(44 + length);
        const view = new DataView(wavBytes.buffer);

        // Write WAV header
        writeString(view, 0, "RIFF");
        view.setUint32(4, 36 + length, true);
        writeString(view, 8, "WAVE");
        writeString(view, 12, "fmt ");
        view.setUint32(16, 16, true);
        view.setUint16(20, 1, true);
        view.setUint16(22, numOfChan, true);
        view.setUint32(24, buffer.sampleRate, true);
        view.setUint32(28, buffer.sampleRate * 2, true);
        view.setUint16(32, numOfChan * 2, true);
        view.setUint16(34, 16, true);
        writeString(view, 36, "data");
        view.setUint32(40, length, true);

        // Write audio data
        for (let i = 0; i < buffer16Bit.length; i++) {
          view.setInt16(44 + i * 2, buffer16Bit[i], true);
        }

        return wavBytes;
      }

      function writeString(view, offset, string) {
        for (let i = 0; i < string.length; i++) {
          view.setUint8(offset + i, string.charCodeAt(i));
        }
      }

      // Utility Calculator Functions
      function calculateBMI() {
        const height =
          parseFloat(document.getElementById("height-cm").value) / 100; // convert to meters
        const weight = parseFloat(document.getElementById("weight-kg").value);
        const resultDiv = document.getElementById("bmi-result");

        if (!height || !weight || height <= 0 || weight <= 0) {
          showAlert("Please enter valid height and weight!", "error");
          return;
        }

        const bmi = weight / (height * height);
        let category;

        if (bmi < 18.5) category = "Underweight";
        else if (bmi < 25) category = "Normal weight";
        else if (bmi < 30) category = "Overweight";
        else category = "Obese";

        resultDiv.innerHTML = `
          <strong>Your BMI:</strong> ${bmi.toFixed(1)}<br>
          <strong>Category:</strong> ${category}
        `;
        resultDiv.style.display = "block";
        showAlert("BMI calculated successfully!", "success");
      }

      function calculateAge() {
        const dob = new Date(document.getElementById("dob").value);
        const today = new Date();
        const resultDiv = document.getElementById("age-result");

        if (isNaN(dob.getTime())) {
          showAlert("Please select a valid date of birth!", "error");
          return;
        }

        const yearsDiff = today.getFullYear() - dob.getFullYear();
        const monthsDiff = today.getMonth() - dob.getMonth();
        const daysDiff = today.getDate() - dob.getDate();

        let age = yearsDiff;
        if (monthsDiff < 0 || (monthsDiff === 0 && daysDiff < 0)) {
          age--;
        }

        const nextBirthday = new Date(dob);
        nextBirthday.setFullYear(today.getFullYear());
        if (nextBirthday < today) {
          nextBirthday.setFullYear(today.getFullYear() + 1);
        }
        const daysToNextBirthday = Math.ceil(
          (nextBirthday - today) / (1000 * 60 * 60 * 24)
        );

        resultDiv.innerHTML = `
          <strong>Your Age:</strong> ${age} years<br>
          <strong>Days until next birthday:</strong> ${daysToNextBirthday} days<br>
          <strong>Birth year:</strong> ${dob.getFullYear()}
        `;
        resultDiv.style.display = "block";
        showAlert("Age calculated successfully!", "success");
      }

      function calculateEMI() {
        const principal = parseFloat(
          document.getElementById("loan-amount").value
        );
        const rate =
          parseFloat(document.getElementById("interest-rate").value) / 1200; // convert to monthly rate
        const time = parseInt(document.getElementById("loan-term").value) * 12; // convert to months
        const resultDiv = document.getElementById("emi-result");

        if (
          !principal ||
          !rate ||
          !time ||
          principal <= 0 ||
          rate <= 0 ||
          time <= 0
        ) {
          showAlert("Please enter valid loan details!", "error");
          return;
        }

        const emi =
          (principal * rate * Math.pow(1 + rate, time)) /
          (Math.pow(1 + rate, time) - 1);
        const totalAmount = emi * time;
        const totalInterest = totalAmount - principal;

        resultDiv.innerHTML = `
          <strong>Monthly EMI:</strong> ${emi.toFixed(2)}<br>
          <strong>Total Interest:</strong> ${totalInterest.toFixed(2)}<br>
          <strong>Total Amount:</strong> ${totalAmount.toFixed(2)}
        `;
        resultDiv.style.display = "block";
        showAlert("EMI calculated successfully!", "success");
      }

      async function convertCurrency() {
        const amount = parseFloat(
          document.getElementById("currency-amount").value
        );
        const from = document.getElementById("currency-from").value;
        const to = document.getElementById("currency-to").value;
        const resultDiv = document.getElementById("currency-result");

        if (!amount || amount <= 0) {
          showAlert("Please enter a valid amount!", "error");
          return;
        }

        try {
          showAlert("Fetching exchange rates...", "info");
          const response = await fetch(
            `https://v6.exchangerate-api.com/v6/6660febab42a503783890cc3/pair/${from}/${to}/${amount}`
          );
          const data = await response.json();

          if (data.result === "success") {
            resultDiv.innerHTML = `
              <strong>${amount} ${from}</strong> = <strong>${data.conversion_result.toFixed(
              2
            )} ${to}</strong><br>
              <small>Exchange rate: 1 ${from} = ${data.conversion_rate.toFixed(
              4
            )} ${to}</small>
            `;
            resultDiv.style.display = "block";
            showAlert("Currency converted successfully!", "success");
          } else {
            showAlert("Error: " + data.error - type, "error");
          }
        } catch (error) {
          showAlert("Error fetching exchange rates: " + error.message, "error");
        }
      }

      function convertUnit() {
        const value = parseFloat(document.getElementById("unit-value").value);
        const category = document.getElementById("unit-category").value;
        const from = document.getElementById("unit-from").value;
        const to = document.getElementById("unit-to").value;
        const resultDiv = document.getElementById("unit-result");

        if (!value || value < 0) {
          showAlert("Please enter a valid value!", "error");
          return;
        }

        // Basic conversion logic (example for length)
        const conversions = {
          length: {
            m: 1,
            km: 1000,
            cm: 0.01,
            mm: 0.001,
            inch: 0.0254,
            ft: 0.3048,
            yd: 0.9144,
            mile: 1609.34,
          },
        };

        if (category === "length") {
          const meters = value * conversions.length[from];
          const result = meters / conversions.length[to];

          resultDiv.innerHTML = `
            <strong>${value} ${from}</strong> = <strong>${result.toFixed(
            4
          )} ${to}</strong>
          `;
          resultDiv.style.display = "block";
          showAlert("Unit conversion successful!", "success");
        }
      }

      function calculateDiscount() {
        const price = parseFloat(
          document.getElementById("original-price").value
        );
        const discount = parseFloat(
          document.getElementById("discount-percent").value
        );
        const resultDiv = document.getElementById("discount-result");

        if (
          !price ||
          !discount ||
          price <= 0 ||
          discount < 0 ||
          discount > 100
        ) {
          showAlert(
            "Please enter valid price and discount percentage!",
            "error"
          );
          return;
        }

        const saving = (price * discount) / 100;
        const finalPrice = price - saving;

        resultDiv.innerHTML = `
          <strong>Original Price:</strong> ${price.toFixed(2)}<br>
          <strong>Discount Amount:</strong> ${saving.toFixed(2)}<br>
          <strong>Final Price:</strong> ${finalPrice.toFixed(2)}
        `;
        resultDiv.style.display = "block";
        showAlert("Discount calculated successfully!", "success");
      }

      // Helper function for audio time conversion
      function timeStringToSeconds(timeStr) {
        const [minutes, seconds] = timeStr.split(":").map(Number);
        return minutes * 60 + seconds;
      }

      // Currency converter helper functions
      function initializeCurrencySelects() {
        const currencies = [
          { code: "USD", name: "US Dollar" },
          { code: "EUR", name: "Euro" },
          { code: "GBP", name: "British Pound" },
          { code: "JPY", name: "Japanese Yen" },
          { code: "AUD", name: "Australian Dollar" },
          { code: "CAD", name: "Canadian Dollar" },
          { code: "CHF", name: "Swiss Franc" },
          { code: "CNY", name: "Chinese Yuan" },
          { code: "INR", name: "Indian Rupee" },
          { code: "NZD", name: "New Zealand Dollar" },
          { code: "SGD", name: "Singapore Dollar" },
          { code: "HKD", name: "Hong Kong Dollar" },
          { code: "AED", name: "UAE Dirham" },
          { code: "THB", name: "Thai Baht" },
          { code: "KRW", name: "South Korean Won" },
        ];

        const fromSelect = document.getElementById("currency-from");
        const toSelect = document.getElementById("currency-to");

        // Clear existing options
        fromSelect.innerHTML = "";
        toSelect.innerHTML = "";

        // Add currency options to both dropdowns
        currencies.forEach((currency) => {
          const fromOption = new Option(
            `${currency.code} - ${currency.name}`,
            currency.code
          );
          const toOption = new Option(
            `${currency.code} - ${currency.name}`,
            currency.code
          );

          fromSelect.add(fromOption);
          toSelect.add(toOption);
        });

        // Set default values
        fromSelect.value = "USD";
        toSelect.value = "EUR";
      }

      // Call currency initialization when document is ready
      document.addEventListener("DOMContentLoaded", function () {
        initializeCurrencySelects();
      });

      // Menu navigation - both mobile and desktop
      function initializeNavigation() {
        // Desktop sidebar navigation
        document.querySelectorAll(".menu-item").forEach((item) => {
          item.addEventListener("click", function () {
            document
              .querySelectorAll(".menu-item")
              .forEach((m) => m.classList.remove("active"));
            document
              .querySelectorAll(".tool-section")
              .forEach((s) => s.classList.remove("active"));

            this.classList.add("active");
            const section = this.getAttribute("data-section");
            document.getElementById(section).classList.add("active");
          });
        });

        // Mobile navigation
        document.querySelectorAll(".mobile-nav-item").forEach((item) => {
          item.addEventListener("click", function () {
            document
              .querySelectorAll(".mobile-nav-item")
              .forEach((m) => m.classList.remove("active"));
            document
              .querySelectorAll(".menu-item")
              .forEach((m) => m.classList.remove("active"));
            document
              .querySelectorAll(".tool-section")
              .forEach((s) => s.classList.remove("active"));

            this.classList.add("active");
            const section = this.getAttribute("data-section");
            document.getElementById(section).classList.add("active");

            // Also activate corresponding desktop menu item
            const desktopItem = document.querySelector(
              `.menu-item[data-section="${section}"]`
            );
            if (desktopItem) {
              desktopItem.classList.add("active");
            }
          });
        });
      }

      // Initialize navigation when DOM is loaded
      document.addEventListener("DOMContentLoaded", initializeNavigation);

      // Tab navigation
      document.querySelectorAll(".tab").forEach((tab) => {
        tab.addEventListener("click", function () {
          const parent = this.closest(".tool-section");
          parent
            .querySelectorAll(".tab")
            .forEach((t) => t.classList.remove("active"));
          parent
            .querySelectorAll(".tab-content")
            .forEach((c) => c.classList.remove("active"));

          this.classList.add("active");
          const tabId = this.getAttribute("data-tab");
          document.getElementById(tabId).classList.add("active");
        });
      });

      // Image enhancement settings
      let enhanceSettings = {
        brightness: 0,
        contrast: 0,
        saturation: 0,
        vibrance: 0,
        warmth: 0,
        sharpness: 0,
        blacks: 0,
        highlights: 0,
      };

      let originalImageData = null;

      function updateEnhancement(slider, type) {
        const value = slider.value;
        document.getElementById(`${type}-value`).textContent = value;
        enhanceSettings[type] = parseInt(value);

        // Debounce preview update for better performance
        clearTimeout(window.previewTimeout);
        window.previewTimeout = setTimeout(previewEnhancements, 16); // ~60fps
      }

      function resetEnhancements() {
        Object.keys(enhanceSettings).forEach((type) => {
          enhanceSettings[type] = 0;
          const slider = document.getElementById(`${type}-slider`);
          const display = document.getElementById(`${type}-value`);
          if (slider && display) {
            slider.value = 0;
            display.textContent = "0";
          }
        });
        previewEnhancements();
      }

      function initializePreview() {
        if (!uploadedImage) return;

        const canvas = document.getElementById("enhance-canvas");
        canvas.style.display = "block";

        // Set canvas size to match image dimensions while maintaining aspect ratio
        const container = canvas.parentElement;
        const containerWidth = container.offsetWidth;
        const containerHeight = container.offsetHeight;
        const imageAspectRatio = uploadedImage.width / uploadedImage.height;

        // Set canvas dimensions to match image resolution
        canvas.width = uploadedImage.width;
        canvas.height = uploadedImage.height;

        // Draw the initial image and store its data
        const ctx = canvas.getContext("2d");
        ctx.drawImage(uploadedImage, 0, 0);
        originalImageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
      }

      function previewEnhancements() {
        if (!uploadedImage || !originalImageData) {
          initializePreview();
          if (!originalImageData) return;
        }

        const canvas = document.getElementById("enhance-canvas");
        const ctx = canvas.getContext("2d");

        // Start with a fresh copy of the original image data
        let enhancedImageData = new ImageData(
          new Uint8ClampedArray(originalImageData.data),
          originalImageData.width,
          originalImageData.height
        );

        let pixelData = enhancedImageData.data;

        // Draw original image
        ctx.drawImage(uploadedImage, 0, 0);

        // Get image data
        let imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        let data = imageData.data;

        // Apply enhancements
        for (let i = 0; i < data.length; i += 4) {
          let r = data[i];
          let g = data[i + 1];
          let b = data[i + 2];

          // Brightness
          const brightnessAdjust = enhanceSettings.brightness * 2.55; // Convert to 0-255 range
          r += brightnessAdjust;
          g += brightnessAdjust;
          b += brightnessAdjust;

          // Contrast
          const contrastFactor =
            (259 * (enhanceSettings.contrast + 255)) /
            (255 * (259 - enhanceSettings.contrast));
          r = contrastFactor * (r - 128) + 128;
          g = contrastFactor * (g - 128) + 128;
          b = contrastFactor * (b - 128) + 128;

          // Saturation
          const saturationFactor = 1 + enhanceSettings.saturation / 100;
          const gray = 0.2989 * r + 0.587 * g + 0.114 * b;
          r = gray * (1 - saturationFactor) + r * saturationFactor;
          g = gray * (1 - saturationFactor) + g * saturationFactor;
          b = gray * (1 - saturationFactor) + b * saturationFactor;

          // Warmth
          const warmthAdjust = enhanceSettings.warmth * 2;
          r += warmthAdjust;
          b -= warmthAdjust;

          // Blacks
          if (enhanceSettings.blacks < 0) {
            const blacksAdjust = Math.abs(enhanceSettings.blacks) / 100;
            if (r < 128) r *= 1 - blacksAdjust;
            if (g < 128) g *= 1 - blacksAdjust;
            if (b < 128) b *= 1 - blacksAdjust;
          }

          // Highlights
          if (enhanceSettings.highlights !== 0) {
            const highlightsAdjust = enhanceSettings.highlights / 100;
            if (r > 128) r += (255 - r) * highlightsAdjust;
            if (g > 128) g += (255 - g) * highlightsAdjust;
            if (b > 128) b += (255 - b) * highlightsAdjust;
          }

          // Ensure values are within bounds
          data[i] = Math.max(0, Math.min(255, r));
          data[i + 1] = Math.max(0, Math.min(255, g));
          data[i + 2] = Math.max(0, Math.min(255, b));
        }

        // Apply sharpness
        if (enhanceSettings.sharpness !== 0) {
          const sharpnessFactor = enhanceSettings.sharpness / 100;
          const sharpenKernel = [0, -1, 0, -1, 5, -1, 0, -1, 0];
          imageData = applyConvolution(
            imageData,
            sharpenKernel,
            sharpnessFactor
          );
        }

        ctx.putImageData(imageData, 0, 0);
        canvas.style.display = "block";
        document.getElementById("download-enhanced").style.display = "block";
      }

      function applyConvolution(imageData, kernel, factor) {
        const side = Math.round(Math.sqrt(kernel.length));
        const halfSide = Math.floor(side / 2);
        const src = imageData.data;
        const sw = imageData.width;
        const sh = imageData.height;
        const tempCanvas = document.createElement("canvas");
        const tempCtx = tempCanvas.getContext("2d");
        tempCanvas.width = sw;
        tempCanvas.height = sh;
        tempCtx.putImageData(imageData, 0, 0);

        const output = tempCtx.createImageData(sw, sh);
        const dst = output.data;

        for (let y = 0; y < sh; y++) {
          for (let x = 0; x < sw; x++) {
            let r = 0,
              g = 0,
              b = 0;
            for (let cy = 0; cy < side; cy++) {
              for (let cx = 0; cx < side; cx++) {
                const scy = y + cy - halfSide;
                const scx = x + cx - halfSide;
                if (scy >= 0 && scy < sh && scx >= 0 && scx < sw) {
                  const srcOff = (scy * sw + scx) * 4;
                  const kernelValue = kernel[cy * side + cx];
                  r += src[srcOff] * kernelValue * factor;
                  g += src[srcOff + 1] * kernelValue * factor;
                  b += src[srcOff + 2] * kernelValue * factor;
                }
              }
            }
            const dstOff = (y * sw + x) * 4;
            dst[dstOff] = Math.min(255, Math.max(0, r));
            dst[dstOff + 1] = Math.min(255, Math.max(0, g));
            dst[dstOff + 2] = Math.min(255, Math.max(0, b));
            dst[dstOff + 3] = src[dstOff + 3];
          }
        }
        return output;
      }

      function applyEnhancements() {
        // Apply the current preview to the main preview
        const canvas = document.getElementById("enhance-canvas");
        const mainPreview = document.getElementById("main-preview");
        mainPreview.src = canvas.toDataURL("image/png");
        showAlert("Enhancements applied successfully!", "success");
      }

      // Image upload handling
      document
        .getElementById("image-input")
        .addEventListener("change", function (e) {
          const file = e.target.files[0];
          if (file) {
            // Hide placeholder and show loading state
            document.getElementById("upload-placeholder").style.opacity = "0.5";
            document.getElementById("upload-placeholder").textContent =
              "Loading...";

            const reader = new FileReader();
            reader.onload = function (event) {
              uploadedImage = new Image();
              uploadedImage.onload = function () {
                // Reset any existing enhancements and clear original data
                resetEnhancements();
                originalImageData = null;

                // Hide placeholder
                document.getElementById("upload-placeholder").style.display =
                  "none";

                // Initialize live preview
                initializePreview();
                document.getElementById("resize-width").value =
                  uploadedImage.width;
                document.getElementById("resize-height").value =
                  uploadedImage.height;
                document.getElementById("crop-w").value = Math.min(
                  400,
                  uploadedImage.width
                );
                document.getElementById("crop-h").value = Math.min(
                  400,
                  uploadedImage.height
                );

                // Update file size display
                if (
                  document.getElementById("resize-mode").value === "filesize"
                ) {
                  updateCurrentFileSize();
                }

                showAlert("Image uploaded successfully!", "success");
              };
              uploadedImage.src = event.target.result;
            };
            reader.readAsDataURL(file);
          }
        });

      // Toggle resize mode
      function toggleResizeMode() {
        const mode = document.getElementById("resize-mode").value;
        const dimensionsControls = document.getElementById(
          "dimensions-controls"
        );
        const filesizeControls = document.getElementById("filesize-controls");

        if (mode === "dimensions") {
          dimensionsControls.style.display = "block";
          filesizeControls.style.display = "none";
        } else {
          dimensionsControls.style.display = "none";
          filesizeControls.style.display = "block";

          // Update current file size display
          if (uploadedImage) {
            updateCurrentFileSize();
          }
        }
      }

      // Update current file size display
      async function updateCurrentFileSize() {
        const canvas = document.createElement("canvas");
        const ctx = canvas.getContext("2d");
        canvas.width = uploadedImage.width;
        canvas.height = uploadedImage.height;
        ctx.drawImage(uploadedImage, 0, 0);

        const blob = await new Promise((resolve) => canvas.toBlob(resolve));
        const size = blob.size;
        const sizeDisplay = document.getElementById("current-file-size");

        if (size > 1024 * 1024) {
          sizeDisplay.textContent = `${(size / (1024 * 1024)).toFixed(2)} MB`;
        } else {
          sizeDisplay.textContent = `${(size / 1024).toFixed(2)} KB`;
        }
      }

      // Calculate dimensions to match target file size
      async function calculateDimensionsForSize(targetSize, unit) {
        const originalCanvas = document.createElement("canvas");
        const ctx = originalCanvas.getContext("2d");
        originalCanvas.width = uploadedImage.width;
        originalCanvas.height = uploadedImage.height;
        ctx.drawImage(uploadedImage, 0, 0);

        const originalBlob = await new Promise((resolve) =>
          originalCanvas.toBlob(resolve)
        );
        const originalSize = originalBlob.size;

        // Convert target size to bytes
        const targetBytes = targetSize * (unit === "MB" ? 1024 * 1024 : 1024);

        // Calculate scaling factor based on file size
        const scaleFactor = Math.sqrt(targetBytes / originalSize);

        return {
          width: Math.round(uploadedImage.width * scaleFactor),
          height: Math.round(uploadedImage.height * scaleFactor),
        };
      }

      // Resize Image
      async function resizeImage() {
        if (!uploadedImage) {
          showAlert("Please upload an image first!", "error");
          return;
        }

        const mode = document.getElementById("resize-mode").value;
        let width, height;

        if (mode === "dimensions") {
          width = parseInt(document.getElementById("resize-width").value);
          height = parseInt(document.getElementById("resize-height").value);
        } else {
          const targetSize = parseFloat(
            document.getElementById("target-size").value
          );
          const unit = document.getElementById("size-unit").value;

          if (isNaN(targetSize) || targetSize <= 0) {
            showAlert("Please enter a valid file size!", "error");
            return;
          }

          try {
            const dimensions = await calculateDimensionsForSize(
              targetSize,
              unit
            );
            width = dimensions.width;
            height = dimensions.height;

            // Update dimension inputs
            document.getElementById("resize-width").value = width;
            document.getElementById("resize-height").value = height;
          } catch (error) {
            showAlert(
              "Error calculating dimensions: " + error.message,
              "error"
            );
            return;
          }
        }

        const canvas = document.getElementById("resize-canvas");
        const ctx = canvas.getContext("2d");

        canvas.width = width;
        canvas.height = height;

        ctx.drawImage(uploadedImage, 0, 0, width, height);

        const preview = document.getElementById("main-preview");
        if (preview) {
          preview.src = canvas.toDataURL();
          preview.style.display = "block";
        }

        document.getElementById("download-resize").style.display =
          "inline-block";

        // Update file size display if in filesize mode
        if (mode === "filesize") {
          const blob = await new Promise((resolve) => canvas.toBlob(resolve));
          const actualSize = blob.size;
          const targetSize = parseFloat(
            document.getElementById("target-size").value
          );
          const unit = document.getElementById("size-unit").value;
          const targetBytes = targetSize * (unit === "MB" ? 1024 * 1024 : 1024);

          const sizeDiff =
            (Math.abs(actualSize - targetBytes) / targetBytes) * 100;
          if (sizeDiff > 10) {
            showAlert(
              `Image resized, but final size varies from target by ${sizeDiff.toFixed(
                1
              )}%`,
              "warning"
            );
          } else {
            showAlert("Image resized successfully!", "success");
          }
        } else {
          showAlert("Image resized successfully!", "success");
        }
      }

      // Enhance Image
      function enhanceImage() {
        if (!uploadedImage) {
          showAlert("Please upload an image first!", "error");
          return;
        }

        const brightness = parseFloat(
          document.getElementById("brightness").value
        );
        const contrast = parseFloat(document.getElementById("contrast").value);

        const canvas = document.getElementById("enhance-canvas");
        const ctx = canvas.getContext("2d");

        canvas.width = uploadedImage.width;
        canvas.height = uploadedImage.height;

        ctx.filter = `brightness(${brightness}) contrast(${contrast})`;
        ctx.drawImage(uploadedImage, 0, 0);

        const preview = document.getElementById("enhance-preview");
        preview.src = canvas.toDataURL();
        preview.style.display = "block";
        document.getElementById("download-enhance").style.display =
          "inline-block";

        showAlert("Image enhanced successfully!", "success");
      }

      // Crop Image
      function cropImage() {
        if (!uploadedImage) {
          showAlert("Please upload an image first!", "error");
          return;
        }

        const x = parseInt(document.getElementById("crop-x").value);
        const y = parseInt(document.getElementById("crop-y").value);
        const w = parseInt(document.getElementById("crop-w").value);
        const h = parseInt(document.getElementById("crop-h").value);

        if (x + w > uploadedImage.width || y + h > uploadedImage.height) {
          showAlert("Crop area exceeds image dimensions!", "error");
          return;
        }

        const canvas = document.getElementById("crop-canvas");
        const ctx = canvas.getContext("2d");

        canvas.width = w;
        canvas.height = h;

        ctx.drawImage(uploadedImage, x, y, w, h, 0, 0, w, h);

        const preview = document.getElementById("crop-preview");
        preview.src = canvas.toDataURL();
        preview.style.display = "block";
        document.getElementById("download-crop").style.display = "inline-block";

        showAlert("Image cropped successfully!", "success");
      }

      // Download Image
      function downloadImage(canvasId, filename) {
        const canvas = document.getElementById(canvasId);
        const link = document.createElement("a");
        link.download = filename;
        link.href = canvas.toDataURL();
        link.click();
      }

      // Generate QR Code
      function generateQR() {
        const text = document.getElementById("qr-input").value;
        if (!text) {
          showAlert("Please enter text or URL!", "error");
          return;
        }

        const output = document.getElementById("qr-output");
        output.innerHTML = "";

        const qrDiv = document.createElement("div");
        qrDiv.id = "qrcode";
        output.appendChild(qrDiv);

        new QRCode(qrDiv, {
          text: text,
          width: 256,
          height: 256,
          colorDark: "#000000",
          colorLight: "#ffffff",
          correctLevel: QRCode.CorrectLevel.H,
        });

        document.getElementById("download-qr").style.display = "inline-block";
        showAlert("QR Code generated successfully!", "success");
      }

      // Download QR Code
      function downloadQR() {
        const canvas = document.querySelector("#qrcode canvas");
        if (canvas) {
          const link = document.createElement("a");
          link.download = "qrcode.png";
          link.href = canvas.toDataURL();
          link.click();
        }
      }

      // Color Picker
      document
        .getElementById("color-picker")
        .addEventListener("input", updateColor);

      function updateColor() {
        const color = document.getElementById("color-picker").value;
        const preview = document.getElementById("color-preview");
        preview.style.backgroundColor = color;

        const r = parseInt(color.substr(1, 2), 16);
        const g = parseInt(color.substr(3, 2), 16);
        const b = parseInt(color.substr(5, 2), 16);

        const output = document.getElementById("color-output");
        output.innerHTML = `
                <strong>HEX:</strong> ${color}<br>
                <strong>RGB:</strong> rgb(${r}, ${g}, ${b})<br>
                <strong>RGBA:</strong> rgba(${r}, ${g}, ${b}, 1)
            `;
      }

      // Initialize color picker
      updateColor();

      // Generate Lorem Ipsum
      function generateLorem() {
        const count = parseInt(document.getElementById("lorem-count").value);
        const lorem = [
          "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.",
          "Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.",
          "Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.",
          "Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.",
          "Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium.",
          "Totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo.",
          "Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores.",
          "Neque porro quisquam est, qui dolorem ipsum quia dolor sit amet, consectetur, adipisci velit.",
          "At vero eos et accusamus et iusto odio dignissimos ducimus qui blanditiis praesentium voluptatum deleniti atque corrupti.",
          "Et harum quidem rerum facilis est et expedita distinctio. Nam libero tempore, cum soluta nobis est eligendi optio.",
        ];

        const result = lorem.slice(0, count).join("\n\n");
        document.getElementById("lorem-output").value = result;
        showAlert("Lorem Ipsum generated!", "success");
      }

      // Test Regex
      function testRegex() {
        const pattern = document.getElementById("regex-pattern").value;
        const text = document.getElementById("regex-text").value;
        const output = document.getElementById("regex-output");

        try {
          const regex = new RegExp(pattern, "g");
          const matches = text.match(regex);

          if (matches && matches.length > 0) {
            let html = `<div class="alert alert-success">✅ Found ${matches.length} match(es):</div>`;
            matches.forEach((match, i) => {
              html += `<div class="output-box">${i + 1}. ${match}</div>`;
            });
            output.innerHTML = html;
          } else {
            output.innerHTML =
              '<div class="alert alert-error">⚠️ No matches found</div>';
          }
        } catch (e) {
          output.innerHTML = `<div class="alert alert-error">❌ Invalid regex: ${e.message}</div>`;
        }
      }

      // Generate Hashes
      function generateHashes() {
        const text = document.getElementById("hash-input").value;
        if (!text) {
          showAlert("Please enter text to hash!", "error");
          return;
        }

        const output = document.getElementById("hash-output");
        output.innerHTML = `
                <div class="output-box">
                    <strong>MD5:</strong> ${CryptoJS.MD5(
                      text
                    ).toString()}<br><br>
                    <strong>SHA1:</strong> ${CryptoJS.SHA1(
                      text
                    ).toString()}<br><br>
                    <strong>SHA256:</strong> ${CryptoJS.SHA256(
                      text
                    ).toString()}<br><br>
                    <strong>SHA512:</strong> ${CryptoJS.SHA512(text).toString()}
                </div>
            `;
        showAlert("Hashes generated!", "success");
      }

      // Generate Password
      document
        .getElementById("pwd-length")
        .addEventListener("input", function () {
          document.getElementById("pwd-length-val").textContent = this.value;
        });

      function generatePassword() {
        const length = parseInt(document.getElementById("pwd-length").value);
        const useUpper = document.getElementById("pwd-upper").checked;
        const useLower = document.getElementById("pwd-lower").checked;
        const useDigits = document.getElementById("pwd-digits").checked;
        const useSpecial = document.getElementById("pwd-special").checked;

        let chars = "";
        if (useUpper) chars += "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
        if (useLower) chars += "abcdefghijklmnopqrstuvwxyz";
        if (useDigits) chars += "0123456789";
        if (useSpecial) chars += "!@#$%^&*()_+-=[]{}|;:,.<>?";

        if (!chars) {
          showAlert("Please select at least one character type!", "error");
          return;
        }

        let password = "";
        for (let i = 0; i < length; i++) {
          password += chars.charAt(Math.floor(Math.random() * chars.length));
        }

        document.getElementById(
          "password-output"
        ).innerHTML = `<strong>Generated Password:</strong><br><br>${password}`;
        document.getElementById("copy-pwd").style.display = "inline-block";
        document.getElementById("copy-pwd").dataset.password = password;
        showAlert("Password generated!", "success");
      }

      function copyPassword() {
        const password = document.getElementById("copy-pwd").dataset.password;
        navigator.clipboard.writeText(password).then(() => {
          showAlert("Password copied to clipboard!", "success");
        });
      }

      // Base64 Encode/Decode
      function convertBase64() {
        const mode = document.querySelector(
          'input[name="base64-mode"]:checked'
        ).value;
        const text = document.getElementById("base64-input").value;
        const output = document.getElementById("base64-output");

        try {
          if (mode === "encode") {
            const encoded = btoa(text);
            output.innerHTML = `<strong>Encoded:</strong><br><br>${encoded}`;
          } else {
            const decoded = atob(text);
            output.innerHTML = `<strong>Decoded:</strong><br><br>${decoded}`;
          }
          showAlert("Conversion successful!", "success");
        } catch (e) {
          showAlert("Error: " + e.message, "error");
        }
      }

      // JWT Decoder
      function decodeJWT() {
        const token = document.getElementById("jwt-input").value.trim();
        const output = document.getElementById("jwt-output");

        try {
          const parts = token.split(".");
          if (parts.length !== 3) {
            throw new Error("Invalid JWT format");
          }

          const header = JSON.parse(atob(parts[0]));
          const payload = JSON.parse(atob(parts[1]));

          output.innerHTML = `
                    <div class="output-box">
                        <strong>Header:</strong><br>
                        <pre>${JSON.stringify(header, null, 2)}</pre>
                        <br>
                        <strong>Payload:</strong><br>
                        <pre>${JSON.stringify(payload, null, 2)}</pre>
                    </div>
                `;
          showAlert("JWT decoded successfully!", "success");
        } catch (e) {
          showAlert("Invalid JWT token: " + e.message, "error");
        }
      }

      // Case Converter
      function convertCase() {
        const text = document.getElementById("case-input").value;
        document.getElementById("case-upper").textContent = text.toUpperCase();
        document.getElementById("case-lower").textContent = text.toLowerCase();
        document.getElementById("case-title").textContent = text.replace(
          /\w\S*/g,
          (txt) => txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase()
        );
        document.getElementById("case-sentence").textContent =
          text.charAt(0).toUpperCase() + text.slice(1).toLowerCase();
        showAlert("Text converted!", "success");
      }

      // Word Counter
      function countWords() {
        const text = document.getElementById("counter-input").value;
        const words = text
          .trim()
          .split(/\s+/)
          .filter((w) => w.length > 0).length;
        const chars = text.length;
        const charsNoSpace = text.replace(/\s/g, "").length;
        const lines = text.split("\n").length;

        document.getElementById("word-count").textContent = words;
        document.getElementById("char-count").textContent = chars;
        document.getElementById("char-no-space").textContent = charsNoSpace;
        document.getElementById("line-count").textContent = lines;
        showAlert("Text analyzed!", "success");
      }

      // Text Diff
      function compareDiff() {
        const text1 = document.getElementById("diff-text1").value;
        const text2 = document.getElementById("diff-text2").value;
        const output = document.getElementById("diff-output");

        const lines1 = text1.split("\n");
        const lines2 = text2.split("\n");

        let html = '<div class="output-box">';
        let foundDiff = false;

        const maxLines = Math.max(lines1.length, lines2.length);

        for (let i = 0; i < maxLines; i++) {
          const l1 = lines1[i] || "";
          const l2 = lines2[i] || "";

          if (l1 !== l2) {
            foundDiff = true;
            html += `<strong>Line ${i + 1}:</strong><br>`;
            html += `- Original: <code>${l1 || "(empty)"}</code><br>`;
            html += `+ Modified: <code>${l2 || "(empty)"}</code><br><br>`;
          }
        }

        if (!foundDiff) {
          html +=
            '<div class="alert alert-success">✅ No differences found! Texts are identical.</div>';
        }

        html += "</div>";
        output.innerHTML = html;
      }

      // Timestamp Tools
      function updateTimestamp() {
        const now = new Date();
        const unix = Math.floor(now.getTime() / 1000);
        const output = document.getElementById("current-timestamp");

        output.innerHTML = `
                <strong>Unix Timestamp:</strong> ${unix}<br><br>
                <strong>ISO Format:</strong> ${now.toISOString()}<br><br>
                <strong>Readable:</strong> ${now.toLocaleString()}
            `;
      }

      function convertTimestamp() {
        const timestamp = parseInt(
          document.getElementById("timestamp-input").value
        );
        const output = document.getElementById("timestamp-output");

        if (isNaN(timestamp)) {
          showAlert("Please enter a valid timestamp!", "error");
          return;
        }

        const date = new Date(timestamp * 1000);
        output.innerHTML = `
                <div class="output-box">
                    <strong>Date:</strong> ${date.toLocaleDateString()}<br><br>
                    <strong>Time:</strong> ${date.toLocaleTimeString()}<br><br>
                    <strong>Full:</strong> ${date.toLocaleString()}
                </div>
            `;
      }

      // Initialize timestamp
      updateTimestamp();

      // Date Calculator
      function calculateDateDiff() {
        const start = new Date(document.getElementById("start-date").value);
        const end = new Date(document.getElementById("end-date").value);
        const output = document.getElementById("date-diff-output");

        if (isNaN(start) || isNaN(end)) {
          showAlert("Please select both dates!", "error");
          return;
        }

        const diff = Math.abs(end - start);
        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        const weeks = Math.floor(days / 7);
        const months = Math.floor(days / 30);

        output.innerHTML = `
                <div class="output-box">
                    <strong>Difference:</strong> ${days} days<br><br>
                    <strong>Weeks:</strong> ${weeks}<br><br>
                    <strong>Months (approx):</strong> ${months}
                </div>
            `;
        showAlert("Date difference calculated!", "success");
      }

      // Code Formatter
      // Code Formatter
      function formatCode() {
        const code = document.getElementById("code-input").value;
        const lang = document.getElementById("code-lang").value;
        const output = document.getElementById("code-output");

        if (!code.trim()) {
          showAlert("Please enter code to format!", "error");
          return;
        }

        try {
          let formatted = "";

          switch (lang) {
            case "json":
              formatted = formatJSON(code);
              break;
            case "javascript":
              formatted = formatJavaScript(code);
              break;
            case "python":
              formatted = formatPython(code);
              break;
            case "html":
              formatted = formatHTML(code);
              break;
            case "css":
              formatted = formatCSS(code);
              break;
            case "xml":
              formatted = formatXML(code);
              break;
            case "sql":
              formatted = formatSQL(code);
              break;
            default:
              formatted = code;
          }

          displayFormattedCode(formatted, lang);
          updateCodeStats(formatted);
          showAlert("Code formatted successfully!", "success");
        } catch (e) {
          showAlert("Error formatting code: " + e.message, "error");
        }
      }

      function formatJSON(code) {
        const parsed = JSON.parse(code);
        return JSON.stringify(parsed, null, 4);
      }

      function formatJavaScript(code) {
        // Basic JavaScript formatting
        let formatted = code;

        // Add line breaks after semicolons
        formatted = formatted.replace(/;(?!\n)/g, ";\n");

        // Add line breaks after opening braces
        formatted = formatted.replace(/\{(?!\n)/g, "{\n");

        // Add line breaks before closing braces
        formatted = formatted.replace(/(?<!\n)\}/g, "\n}");

        // Indent nested code
        const lines = formatted.split("\n");
        let indentLevel = 0;
        const indentedLines = lines.map((line) => {
          const trimmed = line.trim();

          // Decrease indent for closing braces
          if (trimmed.startsWith("}")) {
            indentLevel = Math.max(0, indentLevel - 1);
          }

          const indented = "    ".repeat(indentLevel) + trimmed;

          // Increase indent after opening braces
          if (trimmed.endsWith("{")) {
            indentLevel++;
          }

          return indented;
        });

        return indentedLines.join("\n");
      }

      function formatPython(code) {
        // Basic Python formatting
        let formatted = code;
        const lines = formatted.split("\n");
        let indentLevel = 0;

        const indentedLines = lines.map((line) => {
          const trimmed = line.trim();

          // Decrease indent for dedent keywords
          if (trimmed.match(/^(elif|else|except|finally):/)) {
            indentLevel = Math.max(0, indentLevel - 1);
          }

          const indented = "    ".repeat(indentLevel) + trimmed;

          // Increase indent after colon
          if (trimmed.endsWith(":")) {
            indentLevel++;
          }

          // Decrease indent after return, break, continue (unless in same block)
          if (
            trimmed.match(/^(return|break|continue|pass)/) &&
            !trimmed.endsWith(":")
          ) {
            // Keep same indent
          }

          return indented;
        });

        return indentedLines.join("\n");
      }

      function formatHTML(code) {
        let formatted = code;

        // Add line breaks after tags
        formatted = formatted.replace(/>\s*</g, ">\n<");

        // Indent nested tags
        const lines = formatted.split("\n");
        let indentLevel = 0;
        const selfClosingTags = ["br", "hr", "img", "input", "meta", "link"];

        const indentedLines = lines.map((line) => {
          const trimmed = line.trim();

          // Check for closing tag
          if (trimmed.startsWith("</")) {
            indentLevel = Math.max(0, indentLevel - 1);
          }

          const indented = "    ".repeat(indentLevel) + trimmed;

          // Check for opening tag (not self-closing)
          if (
            trimmed.startsWith("<") &&
            !trimmed.startsWith("</") &&
            !trimmed.endsWith("/>")
          ) {
            const tagName = trimmed.match(/<(\w+)/);
            if (
              tagName &&
              !selfClosingTags.includes(tagName[1].toLowerCase())
            ) {
              // Only increase indent if it's not a closing tag on the same line
              if (!trimmed.includes("</")) {
                indentLevel++;
              }
            }
          }

          return indented;
        });

        return indentedLines.join("\n");
      }

      function formatCSS(code) {
        let formatted = code;

        // Add line breaks
        formatted = formatted.replace(/\{/g, " {\n");
        formatted = formatted.replace(/\}/g, "\n}\n");
        formatted = formatted.replace(/;/g, ";\n");

        // Indent properties
        const lines = formatted.split("\n");
        let indentLevel = 0;

        const indentedLines = lines.map((line) => {
          const trimmed = line.trim();

          if (trimmed === "}") {
            indentLevel = Math.max(0, indentLevel - 1);
          }

          const indented = "    ".repeat(indentLevel) + trimmed;

          if (trimmed.endsWith("{")) {
            indentLevel++;
          }

          return indented;
        });

        return indentedLines.filter((line) => line.trim()).join("\n");
      }

      function formatXML(code) {
        // Similar to HTML formatting
        return formatHTML(code);
      }

      function formatSQL(code) {
        let formatted = code;

        // Add line breaks after SQL keywords
        const keywords = [
          "SELECT",
          "FROM",
          "WHERE",
          "JOIN",
          "LEFT JOIN",
          "RIGHT JOIN",
          "INNER JOIN",
          "OUTER JOIN",
          "ON",
          "GROUP BY",
          "ORDER BY",
          "HAVING",
          "LIMIT",
          "UNION",
          "INSERT INTO",
          "VALUES",
          "UPDATE",
          "SET",
          "DELETE FROM",
        ];

        keywords.forEach((keyword) => {
          const regex = new RegExp(`\\b${keyword}\\b`, "gi");
          formatted = formatted.replace(regex, "\n" + keyword);
        });

        // Clean up multiple newlines
        formatted = formatted.replace(/\n+/g, "\n");

        // Indent
        const lines = formatted.split("\n");
        const indentedLines = lines.map((line, i) => {
          const trimmed = line.trim();
          if (i === 0 || trimmed.match(/^(SELECT|INSERT|UPDATE|DELETE)/i)) {
            return trimmed;
          }
          return "    " + trimmed;
        });

        return indentedLines.join("\n").trim();
      }

      function minifyCode() {
        const code = document.getElementById("code-input").value;
        const lang = document.getElementById("code-lang").value;
        const output = document.getElementById("code-output");

        if (!code.trim()) {
          showAlert("Please enter code to minify!", "error");
          return;
        }

        try {
          let minified = "";

          switch (lang) {
            case "json":
              const parsed = JSON.parse(code);
              minified = JSON.stringify(parsed);
              break;
            case "javascript":
            case "css":
              // Remove comments and extra whitespace
              minified = code
                .replace(/\/\*[\s\S]*?\*\//g, "") // Multi-line comments
                .replace(/\/\/.*/g, "") // Single-line comments
                .replace(/\s+/g, " ") // Multiple spaces to single
                .trim();
              break;
            case "html":
            case "xml":
              minified = code
                .replace(/>\s+</g, "><") // Remove whitespace between tags
                .replace(/\s+/g, " ") // Multiple spaces to single
                .trim();
              break;
            default:
              minified = code.replace(/\s+/g, " ").trim();
          }

          const originalSize = new Blob([code]).size;
          const minifiedSize = new Blob([minified]).size;
          const reduction = (
            ((originalSize - minifiedSize) / originalSize) *
            100
          ).toFixed(1);

          output.innerHTML = `
                    <div class="alert alert-success">
                        ✅ Minified! Reduced by ${reduction}% (${formatFileSize(
            originalSize
          )} → ${formatFileSize(minifiedSize)})
                    </div>
                    <div class="output-box">
                        <pre style="white-space: pre-wrap; word-break: break-all;">${escapeHtml(
                          minified
                        )}</pre>
                    </div>
                `;

          updateCodeStats(minified);
          showAlert("Code minified successfully!", "success");
        } catch (e) {
          showAlert("Error minifying code: " + e.message, "error");
        }
      }

      function beautifyCode() {
        // Same as format but with more spacing
        formatCode();
      }

      function displayFormattedCode(code, lang) {
        const output = document.getElementById("code-output");

        // Syntax highlighting colors
        const highlighted = applySyntaxHighlighting(code, lang);

        output.innerHTML = `
                <div class="card">
                    <h3>Formatted ${lang.toUpperCase()} Code</h3>
                    <div class="output-box" style="background: #2d2d2d; color: #f8f8f2; padding: 20px; border-radius: 8px; overflow-x: auto;">
                        <pre style="margin: 0; font-family: 'Courier New', monospace; line-height: 1.5;">${highlighted}</pre>
                    </div>
                    <button onclick="copyFormattedCode()">📋 Copy Formatted Code</button>
                </div>
            `;
      }

      function applySyntaxHighlighting(code, lang) {
        let highlighted = escapeHtml(code);

        // Basic syntax highlighting
        const patterns = {
          string: /(["'`])(?:(?=(\\?))\2.)*?\1/g,
          comment: /\/\/.*$|\/\*[\s\S]*?\*\//gm,
          keyword:
            /\b(function|var|let|const|if|else|for|while|return|class|import|export|from|async|await|def|print|SELECT|FROM|WHERE|INSERT|UPDATE|DELETE)\b/g,
          number: /\b\d+(\.\d+)?\b/g,
          operator: /[+\-*/%=<>!&|]+/g,
        };

        // Apply colors
        highlighted = highlighted.replace(
          patterns.string,
          '<span style="color: #a8ff60;">$&</span>'
        );
        highlighted = highlighted.replace(
          patterns.keyword,
          '<span style="color: #96cbfe;">$&</span>'
        );
        highlighted = highlighted.replace(
          patterns.number,
          '<span style="color: #ff73fd;">$&</span>'
        );
        highlighted = highlighted.replace(
          patterns.comment,
          '<span style="color: #7c7c7c;">$&</span>'
        );

        return highlighted;
      }

      function updateCodeStats(code) {
        const lines = code.split("\n").length;
        const chars = code.length;
        const size = formatFileSize(new Blob([code]).size);

        document.getElementById("lines-count").textContent = lines;
        document.getElementById("chars-count").textContent = chars;
        document.getElementById("size-count").textContent = size;
        document.getElementById("code-stats").style.display = "block";
      }

      function copyCode() {
        const code = document.getElementById("code-input").value;
        navigator.clipboard.writeText(code).then(() => {
          showCopyFeedback();
          showAlert("Code copied to clipboard!", "success");
        });
      }

      function copyFormattedCode() {
        const preElement = document.querySelector("#code-output pre");
        if (preElement) {
          const code = preElement.textContent;
          navigator.clipboard.writeText(code).then(() => {
            showCopyFeedback();
            showAlert("Formatted code copied!", "success");
          });
        }
      }

      function beautifyCode() {
        // Same as format but with more spacing
        formatCode();
      }

      function formatFileSize(bytes) {
        if (bytes === 0) return "0 Bytes";
        const k = 1024;
        const sizes = ["Bytes", "KB", "MB", "GB"];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + " " + sizes[i];
      }

      function showCopyFeedback() {
        // Visual feedback for copy operations
        const feedback = document.createElement("div");
        feedback.textContent = "✅ Copied!";
        feedback.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: var(--success);
                color: white;
                padding: 10px 20px;
                border-radius: 5px;
                z-index: 1000;
                animation: slideIn 0.3s ease-out;
            `;
        document.body.appendChild(feedback);
        setTimeout(() => feedback.remove(), 2000);
      }

      // PDF Functions - Fully Functional with PDF.js
      let currentPdfDoc = null;
      let currentPageNum = 1;
      let totalPages = 0;
      let sharedPdfFile = null;
      let sharedPdfDoc = null;

      // Configure PDF.js worker
      pdfjsLib.GlobalWorkerOptions.workerSrc =
        "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";

      // Shared PDF file handler
      document
        .getElementById("shared-pdf-input")
        .addEventListener("change", async function (e) {
          const file = e.target.files[0];
          if (file) {
            await loadSharedPDF(file);
          }
        });

      async function loadSharedPDF(file) {
        try {
          sharedPdfFile = file;
          const arrayBuffer = await file.arrayBuffer();
          sharedPdfDoc = await pdfjsLib.getDocument(arrayBuffer).promise;

          // Update status display
          document.getElementById("pdf-filename").textContent = file.name;
          document.getElementById("pdf-pages").textContent =
            sharedPdfDoc.numPages;
          document.getElementById("pdf-size").textContent = formatFileSize(
            file.size
          );
          document.getElementById("pdf-status").style.display = "block";

          showAlert(
            `PDF loaded successfully! ${sharedPdfDoc.numPages} pages`,
            "success"
          );
        } catch (error) {
          document.getElementById("pdf-status").style.display = "none";
          showAlert("Error loading PDF: " + error.message, "error");
        }
      }

      function checkSharedPDF() {
        if (!sharedPdfFile || !sharedPdfDoc) {
          showAlert(
            "Please select a PDF file first using the file input above!",
            "error"
          );
          return false;
        }
        return true;
      }

      async function analyzePDF() {
        if (!checkSharedPDF()) return;

        const output = document.getElementById("pdf-info-output");

        try {
          // Get first page for additional info
          const firstPage = await sharedPdfDoc.getPage(1);
          const viewport = firstPage.getViewport({ scale: 1.0 });

          // Try to get document info
          let docInfo = {};
          try {
            const info = await sharedPdfDoc.getMetadata();
            docInfo = info.info || {};
          } catch (e) {
            console.warn("Could not get PDF metadata:", e);
          }

          // Get PDF version safely
          let pdfVersion = "Unknown";
          try {
            if (sharedPdfDoc.pdfInfo && sharedPdfDoc.pdfInfo.version) {
              pdfVersion = sharedPdfDoc.pdfInfo.version;
            } else {
              // Try to get version from metadata if available
              const info = await sharedPdfDoc.getMetadata();
              if (info.metadata) {
                const metadata = info.metadata.getAll();
                pdfVersion =
                  metadata["pdf:PDFVersion"] ||
                  metadata["PDFVersion"] ||
                  "Unknown";
              }
            }
          } catch (e) {
            console.warn("Could not determine PDF version:", e);
          }

          output.innerHTML = `
                    <div class="card">
                        <h3>📄 PDF Analysis Results</h3>
                        <div class="output-box">
                            <strong>📁 File Information:</strong><br>
                            • Name: ${sharedPdfFile.name}<br>
                            • Size: ${formatFileSize(sharedPdfFile.size)}<br>
                            • Type: ${sharedPdfFile.type}<br>
                            • Modified: ${new Date(
                              sharedPdfFile.lastModified
                            ).toLocaleString()}<br><br>
                            
                            <strong>📋 Document Properties:</strong><br>
                            • Pages: ${sharedPdfDoc.numPages}<br>
                            • Page Size: ${Math.round(
                              viewport.width
                            )} × ${Math.round(viewport.height)} pts<br>
                            • PDF Version: ${pdfVersion}<br><br>
                            
                            <strong>📝 Metadata:</strong><br>
                            • Title: ${docInfo.Title || "Not specified"}<br>
                            • Author: ${docInfo.Author || "Not specified"}<br>
                            • Creator: ${docInfo.Creator || "Not specified"}<br>
                            • Creation Date: ${
                              docInfo.CreationDate
                                ? new Date(
                                    docInfo.CreationDate
                                  ).toLocaleDateString()
                                : "Not specified"
                            }<br>
                        </div>
                    </div>
                `;
          showAlert(
            `PDF analyzed! Found ${sharedPdfDoc.numPages} pages`,
            "success"
          );
        } catch (error) {
          output.innerHTML = `
                    <div class="alert alert-error">
                        ❌ Error analyzing PDF: ${error.message}
                    </div>
                `;
          showAlert("Error analyzing PDF", "error");
        }
      }

      async function previewPDF() {
        if (!checkSharedPDF()) return;

        const loader = document.getElementById("pdf-loader");
        loader.style.display = "block";

        try {
          currentPdfDoc = sharedPdfDoc;
          totalPages = currentPdfDoc.numPages;

          document.getElementById("total-pages").textContent = totalPages;
          document.getElementById("prev-page").disabled = false;
          document.getElementById("next-page").disabled = false;
          document.getElementById("download-page").style.display =
            "inline-block";

          // Load first page
          currentPageNum = 1;
          await renderPage(currentPageNum);

          loader.style.display = "none";
          showAlert(`PDF loaded! ${totalPages} pages`, "success");
        } catch (error) {
          loader.style.display = "none";
          const container = document.getElementById("pdf-canvas-container");
          container.innerHTML = `
                    <div class="alert alert-error">
                        ❌ Error loading PDF: ${error.message}
                    </div>
                `;
          showAlert("Error loading PDF", "error");
        }
      }

      async function renderPage(pageNum) {
        if (!currentPdfDoc) return;

        try {
          const page = await currentPdfDoc.getPage(pageNum);
          const canvas = document.getElementById("pdf-canvas");
          const ctx = canvas.getContext("2d");

          // Calculate scale to fit container
          const containerWidth =
            document.getElementById("pdf-canvas-container").clientWidth - 40;
          const viewport = page.getViewport({ scale: 1.0 });
          const scale = Math.min(containerWidth / viewport.width, 1.5);
          const scaledViewport = page.getViewport({ scale });

          canvas.height = scaledViewport.height;
          canvas.width = scaledViewport.width;

          const renderContext = {
            canvasContext: ctx,
            viewport: scaledViewport,
          };

          await page.render(renderContext).promise;

          document.getElementById("current-page").textContent = pageNum;
          document.getElementById("prev-page").disabled = pageNum <= 1;
          document.getElementById("next-page").disabled = pageNum >= totalPages;
        } catch (error) {
          showAlert("Error rendering page: " + error.message, "error");
        }
      }

      function previousPage() {
        if (currentPageNum <= 1) return;
        currentPageNum--;
        renderPage(currentPageNum);
      }

      function nextPage() {
        if (currentPageNum >= totalPages) return;
        currentPageNum++;
        renderPage(currentPageNum);
      }

      function downloadCurrentPage() {
        const canvas = document.getElementById("pdf-canvas");
        const link = document.createElement("a");
        link.download = `page-${currentPageNum}.png`;
        link.href = canvas.toDataURL();
        link.click();
        showAlert(`Page ${currentPageNum} downloaded!`, "success");
      }

      async function extractPDFText() {
        if (!checkSharedPDF()) return;

        const output = document.getElementById("pdf-text-output");

        const loader = document.getElementById("text-loader");
        loader.style.display = "block";

        try {
          let fullText = "";
          let wordCount = 0;

          // Extract text from all pages
          for (let pageNum = 1; pageNum <= sharedPdfDoc.numPages; pageNum++) {
            const page = await sharedPdfDoc.getPage(pageNum);
            const textContent = await page.getTextContent();

            let pageText = "";
            textContent.items.forEach((item) => {
              pageText += item.str + " ";
            });

            if (pageText.trim()) {
              fullText += `\n--- Page ${pageNum} ---\n${pageText.trim()}\n`;
              wordCount += pageText.trim().split(/\s+/).length;
            }
          }

          loader.style.display = "none";

          if (fullText.trim()) {
            output.innerHTML = `
                        <div class="card">
                            <h3>� Extracted Text</h3>
                            <div class="output-box">
                                <strong>File:</strong> ${sharedPdfFile.name}<br>
                                <strong>Pages:</strong> ${
                                  sharedPdfDoc.numPages
                                }<br>
                                <strong>Words:</strong> ${wordCount}<br>
                                <strong>Characters:</strong> ${fullText.length}
                            </div>
                            <textarea id="extracted-text" readonly style="width: 100%; min-height: 400px; font-family: monospace; font-size: 14px; line-height: 1.5; padding: 15px; border: 1px solid #ddd; border-radius: 8px; background: #f9f9f9;">${fullText.trim()}</textarea>
                            <div style="margin-top: 15px;">
                                <button onclick="copyExtractedText()" class="btn-success">📋 Copy Text</button>
                                <button onclick="downloadExtractedText('${
                                  sharedPdfFile.name
                                }')" class="btn-secondary">⬇️ Download Text</button>
                            </div>
                        </div>
                    `;
            showAlert(
              `Text extracted! ${wordCount} words from ${sharedPdfDoc.numPages} pages`,
              "success"
            );
          } else {
            output.innerHTML = `
                        <div class="card">
                            <h3>📝 Text Extraction</h3>
                            <div class="alert alert-error">
                                ❌ No text found in PDF. This might be a scanned document or image-based PDF.
                                Consider using OCR tools for scanned documents.
                            </div>
                        </div>
                    `;
            showAlert("No text found in PDF", "error");
          }
        } catch (error) {
          loader.style.display = "none";
          output.innerHTML = `
                    <div class="alert alert-error">
                        ❌ Error extracting text: ${error.message}
                    </div>
                `;
          showAlert("Error extracting text", "error");
        }
      }

      function copyExtractedText() {
        const text = document.getElementById("extracted-text").value;
        navigator.clipboard.writeText(text).then(() => {
          showAlert("Text copied to clipboard!", "success");
        });
      }

      function downloadExtractedText(filename) {
        const text = document.getElementById("extracted-text").value;
        const blob = new Blob([text], { type: "text/plain" });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = filename.replace(".pdf", "_extracted.txt");
        link.click();
        showAlert("Text file downloaded!", "success");
      }

      async function mergeWithCurrent() {
        if (!checkSharedPDF()) return;

        const additionalFiles = document.getElementById(
          "pdf-additional-input"
        ).files;
        const output = document.getElementById("pdf-merge-output");

        if (additionalFiles.length === 0) {
          showAlert(
            "Please select additional PDF files to merge with current PDF!",
            "error"
          );
          return;
        }

        const loader = document.getElementById("merge-loader");
        loader.style.display = "block";

        try {
          const mergedPdf = await PDFLib.PDFDocument.create();
          let totalPages = 0;
          let fileList = "";

          // First, add the current PDF
          const currentArrayBuffer = await sharedPdfFile.arrayBuffer();
          const currentPdf = await PDFLib.PDFDocument.load(currentArrayBuffer);
          const currentPageCount = currentPdf.getPageCount();

          const currentPageIndices = Array.from(
            { length: currentPageCount },
            (_, i) => i
          );
          const currentCopiedPages = await mergedPdf.copyPages(
            currentPdf,
            currentPageIndices
          );
          currentCopiedPages.forEach((page) => mergedPdf.addPage(page));

          totalPages += currentPageCount;
          fileList += `1. ${sharedPdfFile.name} (current)<br>`;

          // Then add additional files
          for (let i = 0; i < additionalFiles.length; i++) {
            const file = additionalFiles[i];
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await PDFLib.PDFDocument.load(arrayBuffer);
            const pageCount = pdf.getPageCount();

            const pageIndices = Array.from({ length: pageCount }, (_, i) => i);
            const copiedPages = await mergedPdf.copyPages(pdf, pageIndices);
            copiedPages.forEach((page) => mergedPdf.addPage(page));

            totalPages += pageCount;
            fileList += `${i + 2}. ${file.name}<br>`;
          }

          const mergedBytes = await mergedPdf.save();
          const blob = new Blob([mergedBytes], { type: "application/pdf" });
          const url = URL.createObjectURL(blob);

          loader.style.display = "none";

          output.innerHTML = `
            <div class="card">
              <h3>📑 PDF Merge Complete</h3>
              <div class="output-box">
                <strong>✅ Successfully merged ${
                  additionalFiles.length + 1
                } files:</strong><br><br>
                ${fileList}
                <br><strong>Total pages:</strong> ${totalPages}<br>
                <strong>Output size:</strong> ${formatFileSize(
                  mergedBytes.length
                )}
              </div>
              <div style="margin-top: 15px;">
                <a href="${url}" download="merged_with_current.pdf" class="btn-success" style="text-decoration: none; display: inline-block;">⬇️ Download Merged PDF</a>
                <button onclick="loadMergedAsShared('${url}', 'merged_with_current.pdf', ${
            mergedBytes.length
          })" class="btn-secondary">🔄 Load as Current PDF</button>
                <button onclick="URL.revokeObjectURL('${url}')" class="btn-secondary">🗑️ Clear</button>
              </div>
            </div>
          `;

          showAlert(
            `PDFs merged successfully! ${totalPages} total pages`,
            "success"
          );
        } catch (error) {
          loader.style.display = "none";
          output.innerHTML = `
            <div class="alert alert-error">
              ❌ Error merging PDFs: ${error.message}
            </div>
          `;
          showAlert("Error merging PDFs", "error");
        }
      }

      // Format conversion functions
      async function convertFormat() {
        const fromFormat = document.getElementById("convert-from").value;
        const toFormat = document.getElementById("convert-to").value;
        const file = document.getElementById("convert-file-input").files[0];
        const output = document.getElementById("convert-output");
        const loader = document.getElementById("convert-loader");

        if (!file) {
          showAlert("Please select a file to convert!", "error");
          return;
        }

        loader.style.display = "block";

        try {
          // Here we'll use the appropriate conversion logic based on the formats
          if (fromFormat === toFormat) {
            throw new Error("Source and target formats are the same!");
          }

          let result;
          if (fromFormat !== "pdf" && toFormat === "pdf") {
            // Convert to PDF
            result = await convertToPDF(file, fromFormat);
          } else if (fromFormat === "pdf" && toFormat === "pdfa") {
            // Convert PDF to PDF/A
            result = await convertToPDFA(file);
          } else if (fromFormat === "pdf" && toFormat !== "pdf") {
            // Convert from PDF to other formats
            result = await convertFromPDF(file, toFormat);
          } else {
            // Handle other conversions
            result = await handleOtherConversion(file, fromFormat, toFormat);
          }

          const url = URL.createObjectURL(result.blob);
          loader.style.display = "none";

          output.innerHTML = `
            <div class="card" style="margin-top: 30px; background: rgba(255, 255, 255, 0.05); border-radius: 12px;">
              <h3 style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px;">
                <span style="font-size: 20px;">✅</span>
                <span>Conversion Complete</span>
              </h3>
              <div class="output-box" style="background: rgba(255, 255, 255, 0.1); border-radius: 8px; padding: 16px; margin-bottom: 20px;">
                <div style="display: grid; gap: 8px;">
                  <div><strong style="color: #888;">Source:</strong> <span style="color: #fff;">${
                    file.name
                  }</span></div>
                  <div><strong style="color: #888;">From:</strong> <span style="color: #fff;">${fromFormat.toUpperCase()}</span></div>
                  <div><strong style="color: #888;">To:</strong> <span style="color: #fff;">${toFormat.toUpperCase()}</span></div>
                  <div><strong style="color: #888;">Output size:</strong> <span style="color: #fff;">${formatFileSize(
                    result.blob.size
                  )}</span></div>
                </div>
              </div>
              <div class="button-group" style="display: flex; gap: 10px; justify-content: flex-end;">
                <button onclick="window.location.href='${url}'; URL.revokeObjectURL('${url}')" style="background: rgba(255, 255, 255, 0.1); color: #fff; border: none; padding: 8px 16px; border-radius: 20px; cursor: pointer; display: flex; align-items: center; gap: 8px;">
                  <span style="font-size: 16px;">⬇️</span>
                  <span>Download ${toFormat.toUpperCase()}</span>
                </button>
                ${
                  toFormat === "pdf"
                    ? `
                <button onclick="loadConvertedAsCurrent('${url}', 'converted.pdf', ${result.blob.size})" style="background: rgba(255, 255, 255, 0.1); color: #fff; border: none; padding: 8px 16px; border-radius: 20px; cursor: pointer; display: flex; align-items: center; gap: 8px;">
                  <span style="font-size: 16px;">🔄</span>
                  <span>Load as Current PDF</span>
                </button>
                `
                    : ""
                }
                <button onclick="URL.revokeObjectURL('${url}')" style="background: rgba(255, 255, 255, 0.1); color: #fff; border: none; padding: 8px 16px; border-radius: 20px; cursor: pointer; display: flex; align-items: center; gap: 8px;">
                  <span style="font-size: 16px;">🗑️</span>
                  <span>Clear</span>
                </button>
              </div>
            </div>
          `;
          showAlert("File converted successfully!", "success");
        } catch (error) {
          loader.style.display = "none";
          output.innerHTML = `
            <div class="alert alert-error">
              ❌ Error converting file: ${error.message}
            </div>
          `;
          showAlert("Error converting file", "error");
        }
      }

      // Helper functions for different conversion types
      async function convertToPDF(file, fromFormat) {
        switch (fromFormat) {
          case "doc":
            // Convert DOCX to PDF
            const arrayBuffer = await file.arrayBuffer();
            const mammothResult = await mammoth.convertToHtml({ arrayBuffer });
            const html = mammothResult.value;

            // Use html2pdf to convert the HTML to PDF
            const pdfBlob = await html2pdf().from(html).outputPdf("blob");
            return { blob: pdfBlob };

          case "html":
            // Convert HTML to PDF
            const text = await file.text();
            const pdfFromHtml = await html2pdf().from(text).outputPdf("blob");
            return { blob: pdfFromHtml };

          case "jpg":
            // Convert Image to PDF
            const pdfDoc = await PDFLib.PDFDocument.create();
            const imageBytes = await file.arrayBuffer();
            const image = await pdfDoc.embedJpg(imageBytes);

            const page = pdfDoc.addPage([image.width, image.height]);
            page.drawImage(image, {
              x: 0,
              y: 0,
              width: image.width,
              height: image.height,
            });

            const pdfBytes = await pdfDoc.save();
            return { blob: new Blob([pdfBytes], { type: "application/pdf" }) };

          case "xls":
          case "ppt":
            // For Excel and PowerPoint, we'll convert to HTML first then to PDF
            const workbook = XLSX.read(await file.arrayBuffer(), {
              type: "array",
            });
            const htmlContent = XLSX.write(workbook, {
              type: "string",
              bookType: "html",
            });
            const pdfFromSheet = await html2pdf()
              .from(htmlContent)
              .outputPdf("blob");
            return { blob: pdfFromSheet };

          default:
            throw new Error(
              `Conversion from ${fromFormat} to PDF is not supported`
            );
        }
      }

      async function convertToPDFA(file) {
        // Convert PDF to PDF/A using PDF-Lib
        const pdfDoc = await PDFLib.PDFDocument.load(await file.arrayBuffer());

        // Add PDF/A compliance metadata
        pdfDoc.setTitle("PDF/A Compliant Document");
        pdfDoc.setCreator("Developer Toolbox");
        pdfDoc.setProducer("PDF-Lib");

        // Set color space to RGB
        const metadata = `
          <?xpacket begin="" id="W5M0MpCehiHzreSzNTczkc9d"?>
          <x:xmpmeta xmlns:x="adobe:ns:meta/">
            <rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#">
              <rdf:Description rdf:about="" xmlns:pdfaid="http://www.aiim.org/pdfa/ns/id/">
                <pdfaid:part>1</pdfaid:part>
                <pdfaid:conformance>A</pdfaid:conformance>
              </rdf:Description>
            </rdf:RDF>
          </x:xmpmeta>
          <?xpacket end="w"?>
        `;
        pdfDoc.setSubject(metadata);

        const pdfBytes = await pdfDoc.save();
        return { blob: new Blob([pdfBytes], { type: "application/pdf" }) };
      }

      async function convertFromPDF(file, toFormat) {
        // Load the PDF document
        const pdfBytes = await file.arrayBuffer();
        const pdfDoc = await pdfjsLib.getDocument({ data: pdfBytes }).promise;

        switch (toFormat) {
          case "html":
            let htmlContent = '<div style="font-family: Arial, sans-serif;">';
            for (let i = 1; i <= pdfDoc.numPages; i++) {
              const page = await pdfDoc.getPage(i);
              const textContent = await page.getTextContent();
              htmlContent +=
                '<div style="margin-bottom: 20px; page-break-after: always;">';
              htmlContent += textContent.items
                .map((item) => item.str)
                .join(" ");
              htmlContent += "</div>";
            }
            htmlContent += "</div>";
            return { blob: new Blob([htmlContent], { type: "text/html" }) };

          case "doc":
            // Convert to DOCX using docx.js
            const doc = new docx.Document({
              sections: [
                {
                  properties: {},
                  children: [
                    new docx.Paragraph({
                      children: [
                        new docx.TextRun({
                          text: await extractTextFromPDF(pdfDoc),
                        }),
                      ],
                    }),
                  ],
                },
              ],
            });
            const docxBlob = await docx.Packer.toBlob(doc);
            return { blob: docxBlob };

          case "jpg":
            // Convert first page to JPG using canvas
            const scale = 2; // Higher scale for better quality
            const page = await pdfDoc.getPage(1);
            const viewport = page.getViewport({ scale });
            const canvas = document.createElement("canvas");
            canvas.width = viewport.width;
            canvas.height = viewport.height;
            const context = canvas.getContext("2d");
            await page.render({
              canvasContext: context,
              viewport: viewport,
            }).promise;

            return new Promise((resolve) => {
              canvas.toBlob(
                (blob) => {
                  resolve({ blob });
                },
                "image/jpeg",
                0.95
              );
            });

          default:
            throw new Error(
              `Conversion from PDF to ${toFormat} is not supported`
            );
        }
      }

      async function handleOtherConversion(file, fromFormat, toFormat) {
        // Handle conversions between non-PDF formats
        const content = await file.arrayBuffer();

        switch (fromFormat) {
          case "doc":
            if (toFormat === "html") {
              const result = await mammoth.convertToHtml({
                arrayBuffer: content,
              });
              return { blob: new Blob([result.value], { type: "text/html" }) };
            }
            break;

          case "xls":
            if (toFormat === "html") {
              const workbook = XLSX.read(content, { type: "array" });
              const html = XLSX.write(workbook, {
                type: "string",
                bookType: "html",
              });
              return { blob: new Blob([html], { type: "text/html" }) };
            }
            break;

          case "html":
            if (toFormat === "doc") {
              const text = await file.text();
              const doc = new docx.Document({
                sections: [
                  {
                    properties: {},
                    children: [
                      new docx.Paragraph({
                        children: [new docx.TextRun({ text })],
                      }),
                    ],
                  },
                ],
              });
              const docxBlob = await docx.Packer.toBlob(doc);
              return { blob: docxBlob };
            }
            break;
        }

        throw new Error(
          `Direct conversion from ${fromFormat} to ${toFormat} is not supported. Try converting through PDF as an intermediate format.`
        );
      }

      // Helper function to extract text from PDF
      async function extractTextFromPDF(pdfDoc) {
        let text = "";
        for (let i = 1; i <= pdfDoc.numPages; i++) {
          const page = await pdfDoc.getPage(i);
          const textContent = await page.getTextContent();
          text +=
            textContent.items.map((item) => item.str).join(" ") + "\\n\\n";
        }
        return text;
      }

      // Update the allowed file input types based on selected format
      document
        .getElementById("convert-from")
        .addEventListener("change", function () {
          const fileInput = document.getElementById("convert-file-input");
          const format = this.value;
          const mimeTypes = {
            pdf: ".pdf",
            doc: ".doc,.docx",
            ppt: ".ppt,.pptx",
            xls: ".xls,.xlsx",
            jpg: ".jpg,.jpeg",
            html: ".html,.htm",
          };
          fileInput.accept = mimeTypes[format] || "*/*";
        });

      // Function to load converted PDF as current
      async function loadConvertedAsCurrent(url, filename, size) {
        try {
          // Fetch the blob from the URL
          const response = await fetch(url);
          const blob = await response.blob();

          // Update the shared PDF input status
          document.getElementById("shared-pdf-input").value = "";
          document.getElementById("pdf-filename").textContent = filename;
          document.getElementById("pdf-size").textContent =
            formatFileSize(size);

          // Load the PDF document to get page count
          const arrayBuffer = await blob.arrayBuffer();
          const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
          document.getElementById("pdf-pages").textContent = pdf.numPages;

          // Show the status
          document.getElementById("pdf-status").style.display = "block";
          showAlert("Converted PDF loaded as current file", "success");
        } catch (error) {
          showAlert("Error loading converted PDF: " + error.message, "error");
        }
      }

      async function mergePDFs() {
        const files = document.getElementById("pdf-merge-input").files;
        const output = document.getElementById("pdf-merge-output");

        if (files.length < 2) {
          showAlert("Please select at least 2 PDF files to merge!", "error");
          return;
        }

        const loader = document.getElementById("merge-loader");
        loader.style.display = "block";

        try {
          const mergedPdf = await PDFLib.PDFDocument.create();
          let totalPages = 0;

          for (let i = 0; i < files.length; i++) {
            const file = files[i];
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await PDFLib.PDFDocument.load(arrayBuffer);
            const pageCount = pdf.getPageCount();

            // Copy all pages from current PDF
            const pageIndices = Array.from({ length: pageCount }, (_, i) => i);
            const copiedPages = await mergedPdf.copyPages(pdf, pageIndices);
            copiedPages.forEach((page) => mergedPdf.addPage(page));

            totalPages += pageCount;
          }

          const mergedBytes = await mergedPdf.save();
          const blob = new Blob([mergedBytes], { type: "application/pdf" });
          const url = URL.createObjectURL(blob);

          loader.style.display = "none";

          let fileList = "";
          for (let i = 0; i < files.length; i++) {
            fileList += `${i + 1}. ${files[i].name}<br>`;
          }

          output.innerHTML = `
                    <div class="card">
                        <h3>📑 PDF Merge Complete</h3>
                        <div class="output-box">
                            <strong>✅ Successfully merged ${
                              files.length
                            } files:</strong><br><br>
                            ${fileList}
                            <br><strong>Total pages:</strong> ${totalPages}<br>
                            <strong>Output size:</strong> ${formatFileSize(
                              mergedBytes.length
                            )}
                        </div>
                        <div style="margin-top: 15px;">
                            <a href="${url}" download="merged.pdf" class="btn-success" style="text-decoration: none; display: inline-block;">⬇️ Download Merged PDF</a>
                            <button onclick="loadMergedAsShared('${url}', 'merged.pdf', ${
            mergedBytes.length
          })" class="btn-secondary">🔄 Load as Current PDF</button>
                            <button onclick="URL.revokeObjectURL('${url}')" class="btn-secondary">🗑️ Clear</button>
                        </div>
                    </div>
                `;
          showAlert(
            `PDFs merged successfully! ${totalPages} total pages`,
            "success"
          );
        } catch (error) {
          loader.style.display = "none";
          output.innerHTML = `
                    <div class="alert alert-error">
                        ❌ Error merging PDFs: ${error.message}
                    </div>
                `;
          showAlert("Error merging PDFs", "error");
        }
      }

      async function loadMergedAsShared(url, filename, size) {
        try {
          // Fetch the blob from the URL
          const response = await fetch(url);
          const blob = await response.blob();

          // Create a File object from the blob
          const file = new File([blob], filename, { type: "application/pdf" });

          // Load it as the new shared PDF
          await loadSharedPDF(file);

          showAlert("Merged PDF loaded as current PDF!", "success");

          // Optionally clear the URL to free memory
          URL.revokeObjectURL(url);
        } catch (error) {
          showAlert("Error loading merged PDF: " + error.message, "error");
        }
      }

      async function loadSplitAsShared(url, filename) {
        try {
          // Fetch the blob from the URL
          const response = await fetch(url);
          const blob = await response.blob();

          // Create a File object from the blob
          const file = new File([blob], filename, { type: "application/pdf" });

          // Load it as the new shared PDF
          await loadSharedPDF(file);

          showAlert("Split PDF loaded as current PDF!", "success");

          // Optionally clear the URL to free memory
          URL.revokeObjectURL(url);
        } catch (error) {
          showAlert("Error loading split PDF: " + error.message, "error");
        }
      }

      function showSplitOptions() {
        if (!checkSharedPDF()) return;

        // Set max page numbers based on the shared PDF
        document.getElementById("split-from").max = sharedPdfDoc.numPages;
        document.getElementById("split-to").max = sharedPdfDoc.numPages;
        document.getElementById("split-to").value = sharedPdfDoc.numPages;

        // Update page range info
        const rangeInfo = document.createElement("small");
        rangeInfo.style.color = "#666";
        rangeInfo.textContent = ` (PDF has ${sharedPdfDoc.numPages} pages)`;

        const existingInfo = document.querySelector("#split-options small");
        if (existingInfo) existingInfo.remove();

        document.querySelector("#range-options").appendChild(rangeInfo);

        // Show the options
        document.getElementById("split-options").style.display = "block";
        showAlert(
          `Split options loaded for ${sharedPdfDoc.numPages} pages`,
          "success"
        );
      }

      // Toggle PDF resize mode
      function togglePdfResizeMode() {
        const mode = document.getElementById("pdf-resize-mode").value;
        const dimensionsControls = document.getElementById(
          "pdf-dimensions-controls"
        );
        const filesizeControls = document.getElementById(
          "pdf-filesize-controls"
        );

        if (mode === "dimensions") {
          dimensionsControls.style.display = "block";
          filesizeControls.style.display = "none";
        } else {
          dimensionsControls.style.display = "none";
          filesizeControls.style.display = "block";
          // Update current file size display
          if (sharedPdfFile) {
            document.getElementById("current-pdf-size").textContent =
              formatFileSize(sharedPdfFile.size);
          }
        }
      }

      // Resize PDF function
      async function resizePDF() {
        if (!checkSharedPDF()) return;

        const mode = document.getElementById("pdf-resize-mode").value;
        const output = document.getElementById("pdf-resize-output");
        const loader = document.getElementById("resize-loader");
        loader.style.display = "block";

        try {
          const arrayBuffer = await sharedPdfFile.arrayBuffer();
          const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);
          const pages = pdfDoc.getPages();

          let scale = 1;
          if (mode === "dimensions") {
            // Get scale from input
            scale = parseInt(document.getElementById("pdf-scale").value) / 100;
            if (scale <= 0 || scale > 2) {
              throw new Error("Scale must be between 1% and 200%");
            }
          } else {
            // Calculate scale based on target file size
            const targetSize = parseFloat(
              document.getElementById("pdf-target-size").value
            );
            const unit = document.getElementById("pdf-size-unit").value;
            const targetBytes =
              targetSize * (unit === "MB" ? 1024 * 1024 : 1024);

            // Calculate scale factor based on current file size
            scale = Math.sqrt(targetBytes / sharedPdfFile.size);
            // Limit scale to reasonable bounds
            scale = Math.max(0.1, Math.min(2, scale));
          }

          // Resize each page
          pages.forEach((page) => {
            const { width, height } = page.getSize();
            page.setSize(width * scale, height * scale);
          });

          // Save the modified PDF
          const pdfBytes = await pdfDoc.save();
          const blob = new Blob([pdfBytes], { type: "application/pdf" });
          const url = URL.createObjectURL(blob);

          loader.style.display = "none";

          output.innerHTML = `
            <div class="card">
              <h3>✅ PDF Resize Complete</h3>
              <div class="output-box">
                <strong>Original file:</strong> ${sharedPdfFile.name}<br>
                <strong>Original size:</strong> ${formatFileSize(
                  sharedPdfFile.size
                )}<br>
                <strong>New size:</strong> ${formatFileSize(
                  pdfBytes.length
                )}<br>
                <strong>Scale applied:</strong> ${(scale * 100).toFixed(1)}%<br>
                <strong>Pages processed:</strong> ${pages.length}
              </div>
              <div style="margin-top: 15px;">
                <a href="${url}" download="resized_${
            sharedPdfFile.name
          }" class="btn-success" style="text-decoration: none; display: inline-block;">⬇️ Download Resized PDF</a>
                <button onclick="loadResizedAsShared('${url}', 'resized_${
            sharedPdfFile.name
          }', ${
            pdfBytes.length
          })" class="btn-secondary">🔄 Load as Current PDF</button>
                <button onclick="URL.revokeObjectURL('${url}')" class="btn-secondary">🗑️ Clear</button>
              </div>
            </div>
          `;

          showAlert(
            `PDF resized successfully! ${pages.length} pages processed`,
            "success"
          );
        } catch (error) {
          loader.style.display = "none";
          output.innerHTML = `
            <div class="alert alert-error">
              ❌ Error resizing PDF: ${error.message}
            </div>
          `;
          showAlert("Error resizing PDF", "error");
        }
      }

      async function loadResizedAsShared(url, filename) {
        try {
          const response = await fetch(url);
          const blob = await response.blob();
          const file = new File([blob], filename, { type: "application/pdf" });
          await loadSharedPDF(file);
          showAlert("Resized PDF loaded as current PDF!", "success");
          URL.revokeObjectURL(url);
        } catch (error) {
          showAlert("Error loading resized PDF: " + error.message, "error");
        }
      }

      async function splitPDF() {
        if (!checkSharedPDF()) return;

        const output = document.getElementById("pdf-split-output");

        const loader = document.getElementById("split-loader");
        loader.style.display = "block";

        try {
          // Convert PDF.js document to PDFLib document for manipulation
          const arrayBuffer = await sharedPdfFile.arrayBuffer();
          const pdf = await PDFLib.PDFDocument.load(arrayBuffer);
          const totalPages = pdf.getPageCount();

          const mode = document.querySelector(
            'input[name="split-mode"]:checked'
          ).value;
          let outputFiles = [];

          if (mode === "range") {
            const from = parseInt(document.getElementById("split-from").value);
            const to = parseInt(document.getElementById("split-to").value);

            if (from < 1 || to > totalPages || from > to) {
              throw new Error(
                `Invalid page range. PDF has ${totalPages} pages.`
              );
            }

            const newPdf = await PDFLib.PDFDocument.create();
            const pageIndices = Array.from(
              { length: to - from + 1 },
              (_, i) => from - 1 + i
            );
            const copiedPages = await newPdf.copyPages(pdf, pageIndices);
            copiedPages.forEach((page) => newPdf.addPage(page));

            const pdfBytes = await newPdf.save();
            const blob = new Blob([pdfBytes], { type: "application/pdf" });
            const url = URL.createObjectURL(blob);

            outputFiles.push({
              name: `${sharedPdfFile.name.replace(
                ".pdf",
                ""
              )}_pages_${from}-${to}.pdf`,
              url: url,
              size: pdfBytes.length,
              pages: `${from}-${to}`,
            });
          } else {
            // Split into individual pages
            for (let i = 0; i < totalPages; i++) {
              const newPdf = await PDFLib.PDFDocument.create();
              const [copiedPage] = await newPdf.copyPages(pdf, [i]);
              newPdf.addPage(copiedPage);

              const pdfBytes = await newPdf.save();
              const blob = new Blob([pdfBytes], { type: "application/pdf" });
              const url = URL.createObjectURL(blob);

              outputFiles.push({
                name: `${sharedPdfFile.name.replace(".pdf", "")}_page_${
                  i + 1
                }.pdf`,
                url: url,
                size: pdfBytes.length,
                pages: `${i + 1}`,
              });
            }
          }

          loader.style.display = "none";

          let downloadLinks = "";
          outputFiles.forEach((file, index) => {
            downloadLinks += `
                        <div style="margin: 10px 0; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                            <strong>${file.name}</strong><br>
                            Pages: ${file.pages} | Size: ${formatFileSize(
              file.size
            )}<br>
                            <a href="${file.url}" download="${
              file.name
            }" class="btn-success" style="text-decoration: none; display: inline-block; margin-top: 5px;">⬇️ Download</a>
                            <button onclick="loadSplitAsShared('${
                              file.url
                            }', '${
              file.name
            }')" class="btn-secondary" style="margin-top: 5px; margin-left: 10px;">🔄 Load as Current</button>
                        </div>
                    `;
          });

          output.innerHTML = `
                    <div class="card">
                        <h3>✂️ PDF Split Complete</h3>
                        <div class="output-box">
                            <strong>Original file:</strong> ${
                              sharedPdfFile.name
                            } (${totalPages} pages)<br>
                            <strong>Split into:</strong> ${
                              outputFiles.length
                            } file(s)<br>
                            <strong>Mode:</strong> ${
                              mode === "range"
                                ? "Page Range"
                                : "Individual Pages"
                            }
                        </div>
                        <div style="margin-top: 15px;">
                            <h4>Download Split Files:</h4>
                            ${downloadLinks}
                            <button onclick="clearSplitUrls()" class="btn-secondary" style="margin-top: 10px;">🗑️ Clear All</button>
                        </div>
                    </div>
                `;

          // Store URLs for cleanup
          window.splitUrls = outputFiles.map((f) => f.url);

          showAlert(
            `PDF split successfully into ${outputFiles.length} file(s)!`,
            "success"
          );
        } catch (error) {
          loader.style.display = "none";
          output.innerHTML = `
                    <div class="alert alert-error">
                        ❌ Error splitting PDF: ${error.message}
                    </div>
                `;
          showAlert("Error splitting PDF", "error");
        }
      }

      function clearSplitUrls() {
        if (window.splitUrls) {
          window.splitUrls.forEach((url) => URL.revokeObjectURL(url));
          window.splitUrls = null;
          showAlert("URLs cleared from memory", "success");
        }
      }

      // Keyboard shortcuts for PDF navigation
      document.addEventListener("keydown", function (e) {
        if (
          currentPdfDoc &&
          document.getElementById("pdf-preview").classList.contains("active")
        ) {
          if (e.key === "ArrowLeft" && currentPageNum > 1) {
            e.preventDefault();
            previousPage();
          } else if (e.key === "ArrowRight" && currentPageNum < totalPages) {
            e.preventDefault();
            nextPage();
          }
        }
      });
      document.addEventListener("keydown", function (e) {
        if (
          currentPdfDoc &&
          document.getElementById("pdf-preview").classList.contains("active")
        ) {
          if (e.key === "ArrowLeft" && currentPageNum > 1) {
            e.preventDefault();
            previousPage();
          } else if (e.key === "ArrowRight" && currentPageNum < totalPages) {
            e.preventDefault();
            nextPage();
          }
        }
      });

      // Auto-update split page range
      document
        .getElementById("split-from")
        .addEventListener("input", function () {
          const to = document.getElementById("split-to");
          if (parseInt(this.value) > parseInt(to.value)) {
            to.value = this.value;
          }
        });

      // Cleanup URLs on page unload
      window.addEventListener("beforeunload", function () {
        if (window.splitUrls) {
          window.splitUrls.forEach((url) => URL.revokeObjectURL(url));
        }
      });

      // Initialize merge mode on page load
      document.addEventListener("DOMContentLoaded", function () {
        // Set initial merge mode display
        const multipleOption = document.getElementById("merge-multiple");
        const currentOption = document.getElementById("merge-with-current");

        if (multipleOption && currentOption) {
          multipleOption.classList.add("active");

          // Add event listeners for merge mode radio buttons
          document
            .querySelectorAll('input[name="merge-mode"]')
            .forEach((radio) => {
              radio.addEventListener("change", function () {
                if (this.value === "multiple") {
                  multipleOption.style.display = "block";
                  currentOption.style.display = "none";
                  multipleOption.classList.add("active");
                  currentOption.classList.remove("active");
                } else {
                  multipleOption.style.display = "none";
                  currentOption.style.display = "block";
                  multipleOption.classList.remove("active");
                  currentOption.classList.add("active");
                }
              });
            });
        }
      });

      // Utility Functions
      function showAlert(message, type) {
        const alertDiv = document.createElement("div");
        alertDiv.className = `alert alert-${type}`;
        alertDiv.textContent = message;

        const contentArea = document.querySelector(".content-area");
        contentArea.insertBefore(alertDiv, contentArea.firstChild);

        setTimeout(() => {
          alertDiv.remove();
        }, 3000);
      }

      function copyToClipboard(elementId) {
        const text = document.getElementById(elementId).value;
        navigator.clipboard.writeText(text).then(() => {
          showAlert("Copied to clipboard!", "success");
        });
      }

      function escapeHtml(text) {
        const div = document.createElement("div");
        div.textContent = text;
        return div.innerHTML;
      }

      // Slider value updates
      document
        .getElementById("brightness")
        .addEventListener("input", function () {
          document.getElementById("brightness-val").textContent = this.value;
        });

      document
        .getElementById("contrast")
        .addEventListener("input", function () {
          document.getElementById("contrast-val").textContent = this.value;
        });
    </script>
    <script>
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", function () {
          navigator.serviceWorker
            .register("/sw.js")
            .then(function (registration) {
              console.log(
                "ServiceWorker registration successful with scope: ",
                registration.scope
              );
            })
            .catch(function (err) {
              console.log("ServiceWorker registration failed: ", err);
            });
        });
      }
    </script>
  </body>
</html>
